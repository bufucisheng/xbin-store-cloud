define("home/widget/head_myjd",function(require,exports,module){"use strict";function t(){n.init()}var a=require("/js2/login.js"),i=(require("/js2/dropdown.js"),require("/js2/globalReco.js"),require("/js2/cookie.js")),n={init:function(){var t=$("#ttbar-myjd");t.find(".dd").html('<div class="dd-spacer"></div><div class="dd-inner"><span class="loading"></span></div>'),this.el=t,this.bind()},bind:function(t){var a=this;this.el.dropdown({enterDelay:100,trigger:!0,current:"hover",onchange:function(t){t.attr("data-load")||(t.attr("data-load",1),a.checkLoginInit())}})},checkLoginInit:function(){var t=this;a({automatic:!0,complete:function(a){if(a){var i;i=t.tpl(),a.Identity.IsAuthenticated&&t.hasLoginInit(),t.el.find(".dd").html(i),t.baitiaoInit()}}})},tpl:function(){return'<div class="dd-spacer"></div>\t\t\t\t<div class="myjdlist">\t\t\t\t\t<div class="fore1">\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//order.jd.com/center/list.action" clstag="" target="_blank">待处理订单<span id="num-unfinishedorder"></span></a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//myjd.jd.com/afs/indexNew.action?entry=1" clstag="" target="_blank">返修退换货</a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//t.jd.com/product/followProductList.action?isReduce=true" clstag="" target="_blank">降价商品<span id="num-reduction"></span></a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="fore2">\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//joycenter.jd.com/msgCenter/queryHistoryMessage.action" target="_blank">消息<span id="num-tip"></span></a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="http://question.jd.com/myjd/getMyjdAnswerList.action" clstag="" target="_blank">我的问答<span id="num-consultation"></span></a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//t.jd.com/home/follow" clstag="" target="_blank">我的关注</a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="myjdlist myjdlist_2">\t\t\t\t\t<div class="fore1">\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//bean.jd.com/myJingBean/list" clstag="" target="_blank">我的京豆</a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item baitiao">\t\t\t\t\t\t\t<a href="//baitiao.jd.com/" clstag="jr|keycount|njdhome|wdbaitiao" target="_blank">我的白条</a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="fore2">\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//quan.jd.com/user_quan.action" target="_blank">我的优惠券<span id="num-ticket"></span></a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//trade.jr.jd.com/centre/browse.action" clstag="" target="_blank">我的理财</a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="viewlist" style="display:none;">\t\t\t\t\t<div class="smt">\t\t\t\t\t\t<h4>我的足迹</h4>\t\t\t\t\t\t<span class="extra">\t\t\t\t\t\t\t<a target="_blank" href="//my.jd.com/history/list.html">更多&nbsp;&gt;</a>\t\t\t\t\t\t</span>\t\t\t\t\t</div>\t\t\t\t\t<div class="smc"></div>\t\t\t\t</div>'},hasLoginInit:function(){var t=this;$.ajax({url:"//minijd.jd.com/getHomeCount",dataType:"jsonp",success:function(a){a&&0==a.error&&t.el.find("#num-unfinishedorder").html(t.numStyleSet(a.orderCount))}}),$.ajax({url:"//question.jd.com/myjd/getMyJdAnswerCount.action",dataType:"jsonp",success:function(a){var i=a.data;i.success&&t.el.find("#num-consultation").html(t.numStyleSet(i.result.answerCount))}}),$.ajax({url:"//follow-soa.jd.com/rpc/product/queryForReduceProductCount.action?",data:{sysName:"misc"},dataType:"jsonp",success:function(a){a&&a.data>0&&t.el.find("#num-reduction").html(t.numStyleSet(a.data))}}),$.ajax({url:"//quan.jd.com/getcouponcount.action",dataType:"jsonp",success:function(a){a&&a.CouponCount&&t.el.find("#num-ticket").html(t.numStyleSet(a.CouponCount))}}),$.ajax({url:"//joycenter.jd.com/msgCenter/init.action",dataType:"jsonp",success:function(a){a&&"G001001"==a.result&&t.el.find("#num-tip").html(t.numStyleSet(a.msgUnreadCount))}}),$.ajax({url:"//i.jd.com/user/petName/getUserInfoForMiniJd.action",dataType:"jsonp",success:function(a){if(a){a.imgUrl&&t.el.find(".u-pic img").attr("src",a.imgUrl);var i=a.userLevel;if(i){var n={1:"注册会员",2:"铜牌会员",3:"银牌会员",4:"金牌会员",5:"钻石会员"};$("#userLevel").attr({"class":"user-level"+i,title:n[i]})}a.lastLoginTime?$("#lastLoginTime").html("上次登录："+a.lastLoginTime).show():$("#lastLoginTime").hide()}}})},numStyleSet:function(t){return 0==t?"":'<span class="num style-red">&nbsp;'+t+"</span>"},baitiaoInit:function(t){var a=this;i("pin")?this.baitiaoLinkSet(function(t){var i=a.el.find(".baitiao");t.btName&&t.btUrl&&i.html('<a href="'+t.btUrl+'" target="_blank">'+t.btName+"</a>")}):a.el.find(".baitiao").show()},baitiaoLinkSet:function(t){$.ajax({url:"//btshow.jd.com/ious/queryBT.do?sourceType=137",type:"get",dataType:"jsonp",scriptCharset:"utf-8",success:function(a){a&&a.btList&&a.btList[0]&&t(a.btList[0])}})}};return t});