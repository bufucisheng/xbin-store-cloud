/* toolbar-1.0.0 tools.js Date:2016-11-17 18:06:41 */
define("TB_ROOT/js2/tools",function(require,a){var c=function(a){var b="//p.3.cn/prices/mgets";var c=window.readCookie("ipLoc-djd");var d=a.skus||[];var e=a.loc||c;var f=a.$el||$("body");var g=a.type||1;var h=a.selector||".J-p-";var i=a.text||"\uffe5{NUM}";var j=a.debug||!1;var k=a.callback||function(){};var l=a.complete||function(){};var m=function(a){return"[object Array]"===Object.prototype.toString.call(a)};if(!m(d))throw new Error("Please give skus param with Array type.");return d.length<1?!1:(e=c?e.replace(/-/g,"_"):1,j&&console.info(b+$.param({type:g,area:e,skuIds:"J_"+d.join(",J_")})),void $.ajax({url:b,data:{type:1,area:e,skuIds:"J_"+d.join(",J_")},dataType:"jsonp",success:function(a){var b,c;if(j&&console.info(a),!a&&!a.length)return!1;for(c=a.length,b=0;c>b;b++){if(!a[b].id)return!1;var d=a[b].id.replace("J_","");var e=parseFloat(a[b].p);{parseFloat(a[b].m)}f.find(h+d).html(e>0?i.replace("{NUM}",a[b].p):"\u6682\u65e0\u62a5\u4ef7"),"function"==typeof k&&k(d,a[b])}},complete:function(){"function"==typeof k&&l()}}))};var d=function(a){var b=a.loc||readCookie("ipLoc-djd")||"1_0_0";var c=a.skus||[];var d=a.$el||$("body");a.$target;var f=a.selector||".J-ad-";var g=a.debug||!1;var h=a.callback||function(){};$.ajax({url:"//ad.3.cn/ads/mgets",data:{skuids:"AD_"+c.join(",AD_"),areaCode:b},dataType:"jsonp",scriptCharset:"utf-8",success:function(a){var c,e,i,b=0;if(g&&console.log(a),a&&a.length>0)for(c=a.length,b;c>b;b++)e=a[b].ad,i=a[b].id.replace("AD_",""),d.find(f+i).html(e),h(i,a[b])}})};var e=function(a){var b=a.skus||[];var c=a.$el||$("body");var d=a.selector||".J-comm-";var e=a.text||"(\u5df2\u6709{NUM}\u4eba\u8bc4\u4ef7)";var f=a.debug||!1;var g=a.callback||function(){};var h=a.onlyData||!1;if(!$.isArray(b))throw new Error("Please give skus param with Array type.");$.ajax({url:"//club.jd.com/clubservice.aspx?method=GetCommentsCount&referenceIds="+b,dataType:"jsonp",success:function(a){var b,i;if(a&&a.CommentsCount.length){b=a.CommentsCount.length;for(var j=0;b>j;j++)i=c.find(d+a.CommentsCount[j].SkuId),h||(i.find(".star").removeClass("sa5").addClass("sa"+a.CommentsCount[j].AverageScore),i.html(e.replace("{NUM}",a.CommentsCount[j].CommentCount))),f&&console.log(i),g&&g(a.CommentsCount[j].SkuId,a.CommentsCount[j])}}})};var f=function(a,b){var c=b||"data-src";var d=a.find("img["+c+"]");d.length&&d.each(function(){$(this).attr("src",$(this).attr(c)).removeAttr(c)})};var g=function(a,b){var c=a.length/b;var d=[];for(var e=0;c>e;e++)d.push({tabs:[],increment:null,count:b,skuids:[]});var f=0;for(var g=0;g<a.length;g++)g%b==0&&f++,d[f-1].tabs.push(a[g]),d[f-1].increment=f,d[f-1].skuids.push(a[g].wid);return d};function h(a){a=$.extend({name:"",value:"",expireDay:30,expireDate:null},a||{}),this.init(a.name,a.value,a.expireDay,a.expireDate)}h.prototype={constructor:h,init:function(a,b,c,d){this.set(a,b),this.check()&&this.checkExpire(a,c,d)},check:function(){return"object"==typeof window.localStorage},has:function(a){return localStorage.getItem(a)?!0:!1},set:function(a,b){var c={};this.check()&&(c={value:b,createDate:(new Date).getTime()}),localStorage.setItem(a,JSON.stringify(c))},get:function(a){return this.check()?JSON.parse(localStorage.getItem(a)):void 0},remove:function(a){this.check()&&localStorage[a]&&localStorage.removeItem(a)},clear:function(){localStorage.clear()},checkExpire:function(a,b,c){var e,f,d=(new Date).getTime(),g=this.get(a),h=/[\d]{4}-[\d]{2}-[\d]{2}/;switch(c&&(b=null),!0){case!!c:e=Date.parse(c.replace(/-/g,"/")),d-e>0?this.remove(a):g.removeDate=e,localStorage.setItem(a,JSON.stringify(g));break;case h.test(b):e=Date.parse(b.replace(/-/g,"/")),d-e>0?this.remove(a):g.removeDate=e,localStorage.setItem(a,JSON.stringify(g));break;case b&&0>b:this.remove(a);break;case b>=0:f=g.createDate,e=Date.parse(this.getAfterDate(f,b).replace(/-/g,"/")),d-e>0?this.remove(a):g.removeDate=e,localStorage.setItem(a,JSON.stringify(g))}},getAfterDate:function(a,b){var c,d,e="";return c=new Date(a),d=new Date(c),d.setDate(c.getDate()+b),e=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()},formatStrDate:function(a){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()},formatDate:function(a){var b=new Date(a);return b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()}},a.commentMeta=e,a.priceNum=c,a.adWords=d,a.triggerLazyImg=f,a.reBuildJSON=g});
