define("home/widget/top",["HOME_BASE/tab.js"],function(require,exports,module){"use strict";var t=require("conf"),a=require("load_async"),r=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),this.conf.$el&&(this.supportTransform=o2.detect.css3test("transform"),this.loadErr=[],this.$tabContainer=$(".J_top_tab",this.conf.$el),this.$tabContainer.find(".J_tab_head").length&&this.initTab())},initTab:function(){var t=(this.conf.$el,require("HOME_BASE/tab.js"));new t({container:this.$tabContainer,startAt:0,hash:!1,activeClass:"top_tab_head_item_on",hoverToSwitch:!0,onAfterSwitch:$.proxy(function(t){var a=this.$tabContainer.find(".J_top_tab_active"),r=78*t;this.supportTransform?a.css({transform:"translateX("+r+"px)","-webkit-transform":"translateX("+r+"px)","-moz-transform":"translateX("+r+"px)","-ms-transform":"translateX("+r+"px)"}):a.css("left",r+"px"),$.inArray(t,this.loadErr)>=0&&this.loadTop(t)},this),onFirstShow:$.proxy(this.loadTop,this)})},loadTop:function(r){var e=this,i=this.conf.$el,o=$($(".J_tab_head_item",i).get(r)),s=$($(".J_tab_content_item",i).get(r)).html("").addClass("mod_loading"),n='        {% var list = o.list;var topPrefix = pageConfig.clstagPrefix + \'16\'; %}        <ul class="top_list clearfix">          {% for (j = 0; j < 6; j++) { %}          {% var item = list[j]; %}          <li class="top_item{%= \' top_item_\' + (j + 1) %}">            <a href="{%= item.url %}" target="_blank" class="top_lk" clstag="{%= topPrefix + \'c0'+(1+r)+'0\' + (1 + j) %}">              <div class="top_rank{%= \' top_rank_\' + (j + 1) %}">{%= (j + 1) %}</div>              <div class="top_pic">                <img src="//misc.360buyimg.com/mtd/pc/common/img/blank.png" data-lazy-img="{%= item.imgUrl %}" alt="{%= item.wareName %}" title="{%= item.wareName %}" class="top_img" >              </div>              <p class="top_name">{%= item.wareName %}</p>            </a>          </li>          {% } %}        </ul>',l=o.data("id"),c=t.INTERFACE.TOP;a({backup:c.HOT_SALE_BACKUP_PC,params:{cateid:l},url:c.HOT_SALE,jsonpCallback:"jsonpCallbackTopHotsale"+(r+1),timeout:t.TIMEOUT,dataCheck:function(t){return!!("object"==typeof t&&"0"===t.code&&t.rankInfo&&$.isArray(t.rankInfo.products)&&t.rankInfo.products.length>=6)}}).then(function(a){var i=$.inArray(r,e.loadErr);if("object"==typeof a&&"0"===a.code){var o=a.rankInfo.products,c=window.pageConfig;if(o&&o.length){i>=0&&e.loadErr.splice(i,1);var d=a.rankInfo.products.slice(0,6);d=$.map(d,function(a){var r=a.imgPath,e=a.wareId.match(/(\d)$/)?a.wareId:"11";return r=c.replaceMImageUrl(r,e),a.imgUrl=c.processImageUrl(r,"200x200","100x100"),a.url=t.URLS.TOP+"?hash=sale&cateid="+l+"&time=1DAY&itemid="+a.wareId+"#home",a});try{var m=require("o2tpl"),p=m(n,{list:d})||"";s.removeClass("mod_loading").html(p),_.eventCenter.trigger("lazyload:DOMUpdate",s)}catch(h){i<0&&e.loadErr.push(r),s.removeClass("mod_loading").html('<div class="errtips"></div>')}}else i<0&&e.loadErr.push(r),s.removeClass("mod_loading").html('<div class="errtips"></div>')}else i<0&&e.loadErr.push(r),s.removeClass("mod_loading").html('<div class="errtips"></div>')},function(){var t=$.inArray(r,e.loadErr);t<0&&e.loadErr.push(r),s.removeClass("mod_loading").html('<div class="errtips"></div>')})}});return r});