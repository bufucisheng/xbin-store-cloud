define("home/widget/fbt",function(require){"use strict";var t=require("load_async"),e=require("conf"),n=require("report"),a=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null,domStr:"",next:function(){}},t),this.init()},init:function(){this.data={find:{},brand:{},top:{nav:[]}},this.loadAll()},hideFbt:function(){this.conf.$el.height(0).hide(),n.processHidedFloor(pageConfig.reportFloorHideHash.fbt),_.eventCenter.trigger("render:floorChange","fbt")},loadAll:function(){var t=this,e=t.conf;$.when(this.loadFind(),this.loadBrand(),this.loadTop()).then(function(n,a,o){if(n&&n.length&&a&&a.length&&a[0].data&&o&&o.length){for(var i=a[0].data,r=n[0].list||[],d=r.slice(0,6),c=window.pageConfig,l=0;l<d.length;l++){var s=d[l],f=s.goodsPic;f=f.replace(/!q\d+.jpg/,"").replace(/\.JPG/,".jpg"),f=c.replaceMImageUrl(f,s.id),s.goodsPic=c.processImageUrl(f,"160x160","80x80")}t.data=i||t.data,t.data.find=t.data.find||{},t.data.find.list=d;var p=o[0];if("object"==typeof p&&p.cateList&&p.cateList.length){var u=p.cateList.slice(0,5);t.data.top=t.data.top||{},t.data.top.nav=u}t.renderFbt(t.data)}else e.next&&e.next(),t.hideFbt()},function(){e.next&&e.next(),t.hideFbt()})},renderFbt:function(t){var e=this.conf;try{var n=require("o2tpl"),a=n(e.domStr,t);e.$el.append(a),e.next&&e.next(),this.initTop()}catch(o){e.next&&e.next(),this.hideFbt(),_.console.log(o)}},loadFind:function(){return t({url:e.INTERFACE.FIND,backup:e.INTERFACE.FIND_BACKUP_PC,jsonpCallback:"jsonpCallbackFindGood",timeout:e.TIMEOUT,dataCheck:function(t){return!!(t&&"0"===t.code&&$.isArray(t.list)&&t.list.length>=6)}})},loadBrand:function(){var n=window,a=e.INTERFACE.BRAND,o="aggr";return t({url:a,needStore:!0,backup:n.pageConfig.o2JSConfig.backupPathRule(o),storeSign:n.sourceVersion[o],jsonpCallback:"jsonpCallbackAggr",timeout:e.TIMEOUT,dataCheck:function(t){return!(!t||!t.data||"object"!=typeof t.data.find||"object"!=typeof t.data.brand||"object"!=typeof t.data.top)}})},loadTop:function(){var n=e.INTERFACE.TOP;return t({url:n.RANK_LIST,backup:n.RANK_LIST_BACKUP_PC,jsonpCallback:"jsonpCallbackTopRank",timeout:e.TIMEOUT,dataCheck:function(t){return!!("object"==typeof t&&"0"===t.code&&$.isArray(t.cateList)&&t.cateList.length>=5)}})},initTop:function(){var t=this.conf.$el;seajs.use("home/widget/top",function(e){new e({$el:$(".J_top",t)})})}});return a});