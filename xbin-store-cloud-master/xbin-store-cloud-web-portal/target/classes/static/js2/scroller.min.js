define("home/widget/scroller",function(require,exports,module){"use strict";function t(){var t,i=document.createElement("fakeelement"),s={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in s)if(void 0!==i.style[t])return s[t]}var i=_.Class.extend({construct:function(t){$.extend(this,{$container:null,$scroller:null,scrollItem:"",nextBtn:"",prevBtn:"",itemWidth:0,onInitStyle:function(){},onMouseEnter:function(){},onMouseLeave:function(){}},t),this.$container&&this.$container.length&&this.$scroller&&this.$scroller.length&&this.init()},init:function(){this.transitionEndEvent=t(),this.supportTransform=o2.detect.css3test("transform"),this.eventCenter=new _.Events,this.getElements(),this.initElements(),this.cloneDom(),this.iniSetting(),this.initStyle(),this.initEvent()},getElements:function(){this.$scrollerItems=this.$container.find(this.scrollItem)},cloneDom:function(){var t=this.$container,i=this.$scroller;this.realItemLength=this.$scrollerItems.length,this.mainPage=Math.ceil(this.realItemLength/this.showItemCounts),this.$firstPageItems=t.find(this.scrollItem+":lt("+this.showItemCounts+")"),this.$lastPageItems=t.find(this.scrollItem+":gt("+(this.realItemLength-this.showItemCounts-1)+")"),this.mainPage>1?(this.modNum=this.realItemLength%this.showItemCounts,this.lackNum=this.modNum?this.showItemCounts-this.modNum:this.modNum,this.$nextClone=this.$firstPageItems.clone(),this.$preClone=this.$lastPageItems.clone(),i.prepend(this.$preClone).append(this.$nextClone),this.pos=-this.itemWidth*this.$preClone.length):this.pos=0},iniSetting:function(){this.mainPage>1&&(this.itemCounts=this.$preClone.length+this.$scrollerItems.length+this.$nextClone.length,this.scrollWidth=this.itemWidth*this.itemCounts,this.realScrollWidth=(this.$scrollerItems.length+this.$preClone.length)*this.itemWidth,this.currentPage=1,this.page=Math.ceil(this.itemCounts/this.showItemCounts),this.outCounts=this.itemCounts-this.showItemCounts)},initElements:function(){this.wrapperWidth=this.$container.width(),this.showItemCounts=Math.round(this.wrapperWidth/this.itemWidth)},initStyle:function(){this.$scroller.width(this.scrollWidth),this.mainPage>1?(this.scrollToWithoutAnimation(this.pos),this.$container.find(this.btnWrapper).show()):this.$container.find(this.btnWrapper).hide(),this.onInitStyle.call(this,this.$scrollerItems,this.page,this.showItemCounts),this.$firstPageItems.each($.proxy(function(t,i){var s=$(i).find("img");this.loadImage(s)},this))},initEvent:function(){this.scrollPrevTimer=null,this.scrollNextTimer=null,this.mainPage>1&&(this.$container.delegate(this.prevBtn,"click",$.proxy(this.scrollPrev,this)).delegate(this.nextBtn,"click",$.proxy(this.scrollNext,this)).bind("mouseenter.scroller",$.proxy(function(){this.onMouseEnter.call(this,this.$container)},this)).bind("mouseleave.scroller",$.proxy(function(){this.onMouseLeave.call(this,this.$container)},this)),this.supportTransform&&this.$scroller.unbind(this.transitionEndEvent).bind(this.transitionEndEvent,$.proxy(function(){this.eventCenter.trigger("transitionend.scroller")},this)))},loadImage:function(t){if(t.length){var i=t.data("lazy-src");i&&i.length&&t.attr("src",i).one("load",function(){$(this).removeAttr("data-lazy-src")}).each(function(){this.complete&&$(this).load()})}},scrollPrev:function(){this.scrollPrevTimer&&clearTimeout(this.scrollPrevTimer),this.scrollPrevTimer=setTimeout($.proxy(function(){var t=this.$container;if(this.pos<0){this.pos+=this.itemWidth*this.showItemCounts,this.currentPage===this.mainPage&&(this.pos=Math.min(this.pos,-this.itemWidth*this.$preClone.length)),this.currentPage--;for(var i=this.currentPage*this.showItemCounts;i<(this.currentPage+1)*this.showItemCounts;i++){var s=t.find(this.scrollItem).eq(i).find("img");this.loadImage(s)}this.scrollTo(this.pos,function(){if(0===this.currentPage){this.pos=-this.itemWidth*this.realItemLength,this.currentPage=this.mainPage,this.scrollToWithoutAnimation(this.pos);for(var i=this.currentPage*this.showItemCounts;i<(this.currentPage+1)*this.showItemCounts;i++){var s=t.find(this.scrollItem).eq(i).find("img");this.loadImage(s)}}})}},this),100)},scrollNext:function(){this.scrollNextTimer&&clearTimeout(this.scrollNextTimer),this.scrollNextTimer=setTimeout($.proxy(function(){var t=this.$container;if(this.pos>-this.outCounts*this.itemWidth){this.pos-=this.itemWidth*this.showItemCounts,this.currentPage===this.mainPage-1&&(this.pos=Math.max(this.pos,this.wrapperWidth-this.realScrollWidth)),this.currentPage++;for(var i=this.currentPage*this.showItemCounts;i<(this.currentPage+1)*this.showItemCounts;i++){var s=t.find(this.scrollItem).eq(i).find("img");this.loadImage(s)}this.scrollTo(this.pos,function(){if(this.currentPage>this.mainPage){this.pos=-this.itemWidth*this.$preClone.length,this.currentPage=1;for(var i=this.currentPage*this.showItemCounts;i<(this.currentPage+1)*this.showItemCounts;i++){var s=t.find(this.scrollItem).eq(i).find("img");this.loadImage(s)}this.scrollToWithoutAnimation(this.pos)}})}},this),100)},scrollTo:function(t,i){i=$.isFunction(i)?i:function(){},this.supportTransform?(this.$scroller.css("transform","translateX("+t+"px)"),this.eventCenter.off("transitionend.scroller").on("transitionend.scroller",$.proxy(function(t){i.call(this,t)},this))):this.$scroller.stop().animate({marginLeft:t+"px"},400,$.proxy(i,this))},scrollToWithoutAnimation:function(t){var i=this.$scroller;this.supportTransform?(this.transitionTimer&&clearTimeout(this.transitionTimer),i.css({transform:"translateX("+t+"px)","transition-duration":"0","transition-property":"none"}),this.transitionTimer=setTimeout(function(){i.css({"transition-duration":".6s","transition-property":"transform"})},20)):i.css("marginLeft",t+"px")},reset:function(t){$.extend(this,t),this.$preClone&&this.$preClone.remove(),this.$nextClone&&this.$nextClone.remove(),this.$container.undelegate(this.prevBtn,"click").undelegate(this.nextBtn,"click").unbind("mouseenter.scroller").unbind("mouseleave.scroller"),this.initElements(),this.cloneDom(),this.iniSetting(),this.initStyle(),this.initEvent(),this.scrollToWithoutAnimation(this.pos)}});return i});