/* jdf-1.0.0/ shoppingcart.js Date:2017-02-09 17:08:52 */
define("/js2/shoppingcart.js",["/js2/dropdown.js","/js2/trimPath.js"],function(require){require("/js2/dropdown.js");require("/js2/trimPath.js");window.pageConfig=window.pageConfig||{},pageConfig.shoppingcartUrl=$("#settleup-url").attr("data-from")?$("#settleup-url").attr("data-from"):"//cart.jd.com/";var e={el:null,init:function(){var a=this;a.el=$("#settleup"),a.el.find(".ci-right").html("&gt;"),a.el.find(".dorpdown-layer").html('<div class="spacer"></div><div id="settleup-content"><span class="loading"></span></div>'),a.el.find(".cw-icon .ci-right").after('<i class="ci-count" id="shopping-amount"></i>'),null!=a.DATA_Amount&&$("#shopping-amount").html(a.DATA_Amount),null!=this.el&&($('a[href$="//cart.jd.com/cart/cart.html"]',this.el).attr("href","//cart.jd.com/cart.action"),this.el.dropdown({enterDelay:500,trigger:!0,current:"hover",onchange:function(){a.FN_Refresh(),$("#settleup-url").attr("href",pageConfig.shoppingcartUrl)}}))},DATA_Cookie:"cn",DATA_Amount:readCookie("cn")||"0",URL_Serv:"//cart.jd.com/cart/miniCartServiceNew.action",TPL_Iframe:'<iframe scrolling="no" frameborder="0" marginheight="0" marginwidth="0" id="settleup-iframe"></iframe>',TPL_NoGoods:'<div class="spacer"></div><div class="prompt"><div class="nogoods"><b></b>\u8d2d\u7269\u8f66\u4e2d\u8fd8\u6ca1\u6709\u5546\u54c1\uff0c\u8d76\u7d27\u9009\u8d2d\u5427\uff01</div></div>',TPL_List:{wrap:'<div class="spacer"></div><div id="settleup-content"><div class="smt"><h4 class="fl">\u6700\u65b0\u52a0\u5165\u7684\u5546\u54c1</h4></div><div class="smc"></div><div class="smb ar"><div class="p-total">\u5171<b>${Num}</b>\u4ef6\u5546\u54c1\u3000\u5171\u8ba1<strong>\uffe5 ${TotalPromotionPrice.toFixed(2)}</strong></div><a href="${pageConfig.shoppingcartUrl}" title="\u53bb\u8d2d\u7269\u8f66" id="btn-payforgoods">\u53bb\u8d2d\u7269\u8f66</a></div></div>',sigle:'<ul id="mcart-sigle">{for list in TheSkus}  <li>      <div class="p-img fl"><a href="//item.jd.com/${list.Id}.html" target="_blank"><img src="${pageConfig.FN_GetImageDomain(list.Id)}n5/${list.ImgUrl}" width="50" height="50" alt=""></a></div>      <div class="p-name fl"><a href="//item.jd.com/${list.Id}.html" title="${list.Name}" target="_blank">${list.Name}</a></div>      <div class="p-detail fr ar">          <span class="p-price"><strong>\uffe5${list.PromotionPrice.toFixed(2)}</strong>\xd7${list.Num}</span>          <br>          {if parseInt(list.FanPrice)>0}          <span class="hl-green">\u8fd4\u73b0\uff1a\uffe5<em>${list.FanPrice}</em></span>          <br>          {/if}          {if parseInt(list.Score)>0}          <span class="hl-orange">\u9001\u4eac\u8c46\uff1a<em>${list.Score}</em></span>          <br>          {/if}          <a class="delete" data-id="${list.Id}" data-type="RemoveProduct" href="javascript:void(0)">\u5220\u9664</a>      </div>      {for jq in list.CouponAD}      <div class="gift-jq">[\u8d60\u5238] \u8d60\u9001${jq.Jing}\u4eac\u5238 ${jq.LimitAd}</a></div>      {/for}  </li>{/for}</ul>',gift:'<ul id="mcart-gift">{for list in TheGifts}  <li>      <div class="p-img fl"><a href="//item.jd.com/${list.MainSKU.Id}.html" target="_blank"><img src="${pageConfig.FN_GetImageDomain(list.MainSKU.Id)}n5/${list.MainSKU.ImgUrl}" width="50" height="50" alt=""></a></div>      <div class="p-name fl"><a href="//item.jd.com/${list.MainSKU.Id}.html" title="${list.MainSKU.Name}" target="_blank">${list.MainSKU.Name}</a></div>      <div class="p-detail fr ar">          <span class="p-price"><strong>\uffe5${list.PromotionPrice.toFixed(2)}</strong>\xd7${list.Num}</span>          <br>          {if parseInt(list.FanPrice)>0}          <span class="hl-green">\u8fd4\u73b0\uff1a\uffe5<em>${list.FanPrice}</em></span>          <br>          {/if}          {if parseInt(list.Score)>0}          <span class="hl-orange">\u9001\u4eac\u8c46\uff1a<em>${list.Score}</em></span>          <br>          {/if}          <a class="delete" data-id="${list.MainSKU.Id}" data-type="RemoveProduct" href="#delete">\u5220\u9664</a>      </div>      {for gift in list.Skus}      <div class="gift"><a href="//item.jd.com/${gift.Id}.html" target="_blank">[{if gift.Type==2}\u8d60\u54c1{/if}{if gift.Type==1}\u9644\u4ef6{/if}] ${gift.Name}</a></div>      {/for}      {for jq in list.CouponAD}      <div class="gift-jq">[\u8d60\u5238] \u8d60\u9001${jq.Jing}\u5143\u4eac\u5238 ${jq.LimitAd}</a></div>      {/for}  </li>  {/for}</ul>',suit:'{for suit in TheSuit}<ul id="mcart-suit">  <li class="dt">      <div class="fl"><span>[\u5957\u88c5]</span> ${suit.Name}</div>      <div class="fr"><em>\u5c0f\u8ba1\uff1a\uffe5${(suit.PromotionPrice*suit.Num).toFixed(2)}</em></div>      <div class="clr"></div>  </li>  {for list in suit.Skus}  <li>      <div class="p-img fl"><a href="//item.jd.com/${list.Id}.html" target="_blank"><img src="${pageConfig.FN_GetImageDomain(list.Id)}n5/${list.ImgUrl}" width="50" height="50" alt=""></a></div>      <div class="p-name fl"><span></span><a href="//item.jd.com/${list.Id}.html" title="${list.Name}" target="_blank">${list.Name}</a></div>      <div class="p-detail fr ar">          <span class="p-price"><strong>\uffe5${list.PromotionPrice.toFixed(2)}</strong>\xd7${list.Num}</span>          <br>          {if parseInt(list.FanPrice)>0}          <span class="hl-green">\u8fd4\u73b0\uff1a\uffe5<em>${list.FanPrice}</em></span>          <br>          {/if}          {if parseInt(list.Score)>0}          <span class="hl-orange">\u9001\u4eac\u8c46\uff1a<em>${list.Score}</em></span>          <br>          {/if}          <a class="delete" data-id="${list.Id}|${suit.Id}" data-type="RemoveSuit" href="javascript:void(0)">\u5220\u9664</a>      </div>      {for gift in list.Gifts}      <div class="gift"><a href="//item.jd.com/${gift.Id}.html" target="_blank">[{if gift.Type==2}\u8d60\u54c1{/if}{if gift.Type==1}\u9644\u4ef6{/if}] ${gift.Name}</a></div>      {/for}      {for jq in list.CouponAD}      <div class="gift-jq">[\u8d60\u5238] \u8d60\u9001${jq.Jing}\u5143\u4eac\u5238 ${jq.LimitAd}</a></div>      {/for}  </li>  {/for}</ul>{/for}',mj:'{for mj in ManJian}<ul id="mcart-mj">  <li class="dt">      <div class="fl"><span class="hl-green">\u6ee1\u51cf</span>{if mj.ManFlag} \u5df2\u8d2d\u6ee1{if mj.ManNum>0}${mj.ManNum}\u4ef6{else}${mj.ManPrice}\u5143{/if}\uff0c\u5df2\u51cf${mj.JianPrice}\u5143{else}\u8d2d\u6ee1{if mj.ManNum>0}${mj.ManNum}\u4ef6{else}${mj.ManPrice}\u5143{/if}\uff0c\u5373\u53ef\u4eab\u53d7\u6ee1\u51cf\u4f18\u60e0{/if}</div>      <div class="fr"><em>\u5c0f\u8ba1\uff1a\uffe5${(mj.PromotionPrice*mj.Num).toFixed(2)}</em></div>      <div class="clr"></div>  </li>  {for list in mj.Skus}  <li>      <div class="p-img fl"><a href="//item.jd.com/${list.Id}.html" target="_blank"><img src="${pageConfig.FN_GetImageDomain(list.Id)}n5/${list.ImgUrl}" width="50" height="50" alt=""></a></div>      <div class="p-name fl"><span></span><a href="//item.jd.com/${list.Id}.html" title="${list.Name}" target="_blank">${list.Name}</a></div>      <div class="p-detail fr ar">          <span class="p-price"><strong>\uffe5${list.PromotionPrice.toFixed(2)}</strong>\xd7${list.Num}</span>          <br>          {if parseInt(list.FanPrice)>0}          <span class="hl-green">\u8fd4\u73b0\uff1a\uffe5<em>${list.FanPrice}</em></span>          <br>          {/if}          {if parseInt(list.Score)>0}          <span class="hl-orange">\u9001\u4eac\u8c46\uff1a<em>${list.Score}</em></span>          <br>          {/if}          <a class="delete" data-id="${list.Id}|${mj.Id}" data-type="RemoveSuit" href="#delete">\u5220\u9664</a>      </div>      {for gift in list.Gifts}      <div class="gift"><a href="//item.jd.com/${gift.Id}.html" target="_blank">[{if gift.Type==2}\u8d60\u54c1{/if}{if gift.Type==1}\u9644\u4ef6{/if}] ${gift.Name}</a></div>      {/for}      {for jq in list.CouponAD}      <div class="gift-jq">[\u8d60\u5238] \u8d60\u9001${jq.Jing}\u5143\u4eac\u5238 ${jq.LimitAd}</a></div>      {/for}  </li>  {/for}</ul>{/for}',mz:'{for mz in ManZeng}<ul id="mcart-mz">  <li class="dt">      <div class="fl"><span class="hl-orange">{if mz.AddMoney > 0}\u52a0\u4ef7\u8d2d{else}\u6ee1\u8d60{/if}</span>			{if mz.AddMoney <= 0}          	{if mz.ManFlag}              	\u5df2\u8d2d\u6ee1${mz.ManPrice}\u5143\uff0c\u60a8{if mz.ManGifts.length>0}\u5df2{else}\u53ef{/if}\u9886\u8d60\u54c1          	{else}              	\u8d2d\u6ee1${mz.ManPrice}\u5143\uff0c\u5373\u53ef\u9886\u53d6\u8d60\u54c1          	{/if}          {else}				{if mz.ManFlag}              	\u5df2\u8d2d\u6ee1${mz.ManPrice}\u5143\uff0c\u60a8{if mz.ManGifts.length>0}\u5df2{else}\u53ef{/if}\u52a0\u4ef7\u6362\u8d2d\u5546\u54c1          	{else}              	\u8d2d\u6ee1${mz.ManPrice}\u5143\uff0c\u5373\u53ef\u52a0\u4ef7\u6362\u8d2d\u5546\u54c1          	{/if}          {/if}      </div>      <div class="fr"><em>\u5c0f\u8ba1\uff1a\uffe5${(mz.PromotionPrice*mz.Num).toFixed(2)}</em></div>      <div class="clr"></div>  </li>  {for gift in mz.ManGifts}<li class="dt-mz"><a href="${gift.Id}" target="_blank">[{if mz.AddMoney > 0}\u6362\u8d2d\u54c1{else}\u8d60\u54c1{/if}]${gift.Name}</a>\xd7${gift.Num}</li>{/for}  {for list in mz.Skus}  <li>      <div class="p-img fl"><a href="//item.jd.com/${list.Id}.html" target="_blank"><img src="${pageConfig.FN_GetImageDomain(list.Id)}n5/${list.ImgUrl}" width="50" height="50" alt=""></a></div>      <div class="p-name fl"><span></span><a href="//item.jd.com/${list.Id}.html" title="${list.Name}" target="_blank">${list.Name}</a></div>      <div class="p-detail fr ar">          <span class="p-price"><strong>\uffe5${list.PromotionPrice.toFixed(2)}</strong>\xd7${list.Num}</span>          <br>          {if parseInt(list.FanPrice)>0}          <span class="hl-green">\u8fd4\u73b0\uff1a\uffe5<em>${list.FanPrice}</em></span>          <br>          {/if}          {if parseInt(list.Score)>0}          <span class="hl-orange">\u9001\u4eac\u8c46\uff1a<em>${list.Score}</em></span>          <br>          {/if}          <a class="delete" data-id="${list.Id}|${mz.Id}" data-type="RemoveSuit" href="#delete">\u5220\u9664</a>      </div>      {for gift in list.Gifts}      <div class="gift"><a href="//item.jd.com/${gift.Id}.html" target="_blank">[{if gift.Type==2}\u8d60\u54c1{/if}{if gift.Type==1}\u9644\u4ef6{/if}] ${gift.Name}</a></div>      {/for}      {for jq in list.CouponAD}      <div class="gift-jq">[\u8d60\u5238] \u8d60\u9001${jq.Jing}\u5143\u4eac\u5238 ${jq.LimitAd}</a></div>      {/for}  </li>  {/for}</ul>{/for}'},FN_BindEvents:function(){var a=this;$("#settleup-content .delete").bind("click",function(){var b=$(this).attr("data-id").split("|"),c=$(this).attr("data-type"),d={method:c,cartId:b[0]};b&&(b.length>1&&b[1]&&(d.targetId=b[1]),$.ajax({url:a.URL_Serv,data:d,dataType:"jsonp",success:function(b){b.Result&&a.FN_Refresh()}}))})},FN_Refresh:function(){var a=this;var b=this.el;var c;c=/dl/.test(b.selector)?b.find("dd").eq(0):b.find(".dorpdown-layer").eq(0);var e=function(b){var d=b.Cart,e=d.TheSkus.length+d.TheSuit.length+d.TheGifts.length+d.ManJian.length+d.ManZeng.length,f=a.TPL_List.sigle.process(b.Cart),g=a.TPL_List.gift.process(b.Cart),h=a.TPL_List.suit.process(b.Cart),i=a.TPL_List.mz.process(b.Cart),j=a.TPL_List.mj.process(b.Cart);if(e>0?(c.html(a.TPL_List.wrap.process(b.Cart)),c.find("#settleup-content .smc").html(f+g+h+j+i),$("#settleup-url").attr("href",pageConfig.shoppingcartUrl)):c.html(a.TPL_NoGoods),$.browser.msie&&6==$.browser.version){var k=$("#settleup-content");k.before(a.TPL_Iframe);var l=$("#settleup-iframe");l.height(k.height())}a.FN_BindEvents()};$.ajax({url:a.URL_Serv,data:{method:"GetCart"},dataType:"jsonp",success:function(a){e(a)}}),a.DATA_Amount=readCookie(a.DATA_Cookie),null!=a.DATA_Amount&&$("#shopping-amount").html(a.DATA_Amount).parent().show()}};function f(){e.init()}return f});
