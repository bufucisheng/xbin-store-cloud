/* virtuals-squares/1.0/ hotel.js Date:2017-01-10 18:00:37 */
define("virtuals/squares/1.0/js/hotel.js",["virtuals/popui/1.0.0/js/lang/date.js","jdf/1.0.0/ui/calendar/1.0.0/calendar.js","virtuals/popui/1.0.0/js/root.js","//misc.360buyimg.com/virtuals/squares/1.0/js/ui/popui-suggest.js","virtuals/popui/1.0.0/css/suggest/suggest.css","//misc.360buyimg.com/virtuals/squares/1.0/js/ui/popui-tab.js","//misc.360buyimg.com/virtuals/squares/1.0/js/ui/popui-setCursorPosition.js","//misc.360buyimg.com/virtuals/squares/1.0/js/ui/popui-placeholder.js","//misc.360buyimg.com/virtuals/squares/1.0/js/ui/popui-cityLayer.js","virtuals/squares/1.0/js/hotelcity.js","virtuals/popui/1.0.0/js/lang/date.js","//misc.360buyimg.com/virtuals/squares/1.0/js/hotel-squares.js"],function(require,a){var c=require("virtuals/popui/1.0.0/js/lang/date.js");require("jdf/1.0.0/ui/calendar/1.0.0/calendar.js"),require("virtuals/popui/1.0.0/js/root.js"),require("//misc.360buyimg.com/virtuals/squares/1.0/js/ui/popui-suggest.js"),require("virtuals/popui/1.0.0/css/suggest/suggest.css"),require("//misc.360buyimg.com/virtuals/squares/1.0/js/ui/popui-tab.js"),require("//misc.360buyimg.com/virtuals/squares/1.0/js/ui/popui-setCursorPosition.js"),require("//misc.360buyimg.com/virtuals/squares/1.0/js/ui/popui-placeholder.js"),require("//misc.360buyimg.com/virtuals/squares/1.0/js/ui/popui-cityLayer.js");var d=require("virtuals/squares/1.0/js/hotelcity.js");require("virtuals/popui/1.0.0/js/lang/date.js");var f=require("//misc.360buyimg.com/virtuals/squares/1.0/js/hotel-squares.js");$.fn.popuigetPopUI=function(a){return this.data(a)},$.fn.popuisuggest.except={"\u9152\u5e97/\u5546\u5708/\u5730\u6807":1,"\u8bf7\u8f93\u5165\u76ee\u7684\u5730":1};var g,h,i,j;var k={};var l,m;var n;var p=[];var q={gn:"\u5317\u4eac"};function r(a){try{a.el.html(f)}catch(b){}s.initDefault().bindEvent().initLayourData().initPlaceholder().initCalendar().initSelectArea().initAds()}var s={initDefault:function(){var a=this;return g=$("#squares-hotel"),h=g.find(".hotel-tab"),i=g.find(".tab-content"),j=g.find(".hotel-content"),k={city:g.find("#sqgn-City"),start:g.find("#sqgn-start"),end:g.find("#sqgn-end"),area:g.find("#sqgn-area"),searchBtn:g.find("#search-hotel-gn")},k.city.val(q.gn).css("color","rgb(102,102,102)"),a},bindEvent:function(){var a=this;return h.bind("mouseenter",function(b){b.preventDefault();var c=this;clearTimeout(l),l=setTimeout(function(){var b=$(c).index();a.switchToCon(b)},400)}).bind("mouseleave",function(){clearTimeout(l)}),g.bind("mouseleave",function(){m=setTimeout(function(){$(".sqhotel-city").hide(),$(".area-dialog").hide()},400)}),$("body").delegate(".sqhotel-city,.area-dialog","mouseenter",function(){clearTimeout(m)}).bind("mouseleave",function(){m=setTimeout(function(){$(this).hide()},40)}),k.area.bind("click",function(){$(this).select(),a.createInitCity($(this))}),k.searchBtn.bind("click",function(){a.goToLink("gn")}),k.area.bind("keyup",function(){$(".area-dialog").hide()}),$("body").bind("click",function(a){a.target!=k.city[0]&&0==$(a.target).parents(".sqhotel-city").length&&$(".sqhotel-city").hide(),a.target!=k.area[0]&&$(".area-dialog").hide()}),a},switchToCon:function(a){var b=this;var c=j.eq(0).outerWidth();var d=c*a;i.stop().animate({marginLeft:-d},300),h.removeClass("current").eq(a).addClass("current"),b.resetAllLayer()},resetAllLayer:function(){$(".squares-hotel-calendar,.area-dialog,.sqhotel-city").hide()},initPlaceholder:function(){var a=this;return g.find("input[placeholder], textarea").each(function(){var a=navigator.userAgent.indexOf("MSIE 7.0")>0;var b=navigator.userAgent.indexOf("MSIE 8.0")>0;var c=navigator.userAgent.indexOf("MSIE 9.0")>0;var d=$(this).attr("placeholder");(c||b||a)&&$(this).popuiplaceholder({word:d,evtType:"focus",color:"#aaa"})}),a},initLayourData:function(){var a=this;return $.ajax({url:"//hotel.jd.com/jsonp/citySuggest.action",type:"get",async:!1,dataType:"jsonp",success:function(b){1==b.retCode&&(n=b.retMessage,a.setCityID("gn"))},error:function(){console.warn("\u63a5\u53e3\u6570\u636e\u6709\u95ee\u9898")}}),$.ajax({url:"//hotel.jd.com/jsonp/geoCityInfo.action",type:"get",async:!1,dataType:"jsonp",success:function(b){cityLayerDate=b,gncitysDate=cityLayerDate.cities,pycitys=function(){var a={HOT:cityLayerDate.hotCities};var b=["hot","a","b","c","d","e","f","g","h","i","j","k","l","m","n"],c=["o","p","q","r","s","t","u","v","w","x","y","z"],d=b.concat(c);for(var e=0;e<d.length;e++){var f=d[e];f=f.toUpperCase();var g=a[f]||(a[f]=[]);for(var h=0;h<gncitysDate.length;h++){var i=gncitysDate[h];var j=i[4];var k=j;f==k&&g.push(i)}}for(var l=0;l<d.length;l++){var f=d[l];f=f.toUpperCase(),0==a[f].length&&delete a[f]}return a}(),a.initCity()}}),a},initCity:function(){var a=this;var b=k.city.popuicityLayer({title:"\u652f\u6301\u4e2d\u6587/\u62fc\u97f3/\u7b80\u62fc\u8f93\u5165",layerCls:"recommend sepc-rec sqhotel-city",tab:["\u70ed\u95e8\u57ce\u5e02","ABC","DEFG","HJ","kLM","NPQ","RSTW","XYZ"],left:-172,top:0,data:pycitys});k.city.popuisuggest({size:4,wrapCls:"ac_results city_suggest",currCls:"ac_over",getParam:function(){return{city:k.city.val()}},url:"//hotel.jd.com/json/getCities.action?callback=?",withDraw:function(a){var b=a.retMessage.splice(0,4);return $.map(b,function(a){var b=a[0].split(",");return{text:a[1],val:a[1],lat:b[0],lng:b[1]}})},renderItem:function(a){var b='<li data-val="'+a.val+'" rel="'+a.lat+'"><a href="#">'+a.text+"</a></li>";return b},renderHead:function(a){return'<div class="gray ac_result_tip" style="line-height:20px;">'+a+"\uff0c\u6309\u62fc\u97f3\u6392\u5e8f</div>"},renderNone:function(a){return'<div class="gray ac_result_null">\u5bf9\u4e0d\u8d77\uff0c\u627e\u4e0d\u5230\uff1a'+a+"</div>"}},function(){}).focus(function(){$(this).select()}).keyup(function(){""==$(this).val()&&$(this).trigger("click")});var d=b.getPopUI("cityLayer");var e=b.getPopUI("suggest");return d.bind("choose",function(b,c){a.selectCityOprate(c)}),e.bind("choose",function(b,c){a.selectCityOprate(c)}),a},selectCityOprate:function(a){k.city.attr("data-val",a.szm),k.city.attr("data-choose",k.city.val()),$(".start-city").css({color:"rgb(102, 102, 102)"}),k.start.click();var b=$(".select-area").attr("data-val");b&&b==k.city.val()||$(".select-area").val(""),$(".select-area").attr("data-val",k.city.val())},createInitCity:function(a){var b=a.offset().left;var c=a.offset().top;var e='<div class="area-dialog"></div>';var f=this;var g=$(e);g.css({left:b-350+180,top:c+23});var h=k.city.attr("data-val");if(!h){var i=k.city.val();var j=f.hasCity(i,0);h=j?j:"",k.city.attr("data-val",h)}void 0==d.cityArea[h]?console.log(h+"\u65e0\u63a8\u8350\u5546\u5708"):(g.append(d.cityArea[h]),$("body").append(g),g.delegate("a","click",function(){var b=$(this).text();a.val(b).css("color","rgb(102, 102, 102)")}))},initSelectArea:function(){var a=this;return k.area.popuisuggest({isCache:!1,wrapCls:"ac_results keyword_suggest",currCls:"ac_over",getParam:function(){return{city:k.city.val()}},url:"//hotel.jd.com/json/getPosition.action?callback=?",withDraw:function(a){var b=a.retMessage.splice(0,4);return $.map(b,function(a){var b=a[0].split(",");return{text:a[1],val:a[1],lat:b[0],lng:b[1]}})},renderItem:function(a){var b='<li data-val="'+a.val+'" data-lat="'+a.lat+'" data-lng="'+a.lng+'" title="'+a.text+'"><a href="#">'+a.text+"</a></li>";return b},renderHead:function(a){return'<div class="gray ac_result_tip" style="line-height:20px;">'+a+"\uff0c\u6309\u62fc\u97f3\u6392\u5e8f</div>"},renderNone:function(a){return'<div class="gray ac_result_null">\u5bf9\u4e0d\u8d77\uff0c\u627e\u4e0d\u5230\uff1a'+a+"</div>"}}),a},initCalendar:function(){var a=this;return g.find(".start-date,.end-date").each(function(){try{var b=new Date;var c;var d;$(this).hasClass("end-date")?(c=a.getNextDay(b.getFullYear()+"/"+(b.getMonth()+1)+"/"+b.getDate(),1),d=a.getNextDay(b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate(),2)):(c=a.getNextDay(b.getFullYear()+"/"+(b.getMonth()+1)+"/"+b.getDate(),-1),d=a.getNextDay(b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate(),1)),$(this).val(d).attr("data-val",d).css("color","#666");var e=$(this).calendar({hasFestival:!0,format:"yyyy-mm-dd",isCompleteMode:!1,beginDate:c,onReady:function(){var a;e.calendar.addClass("squares-hotel-calendar").hover(function(){clearTimeout(a)},function(){clearTimeout(a),a=setTimeout(function(){e.hide(),e.el.removeClass("squares-focus-hover-style")},400)}).click(function(a){a.stopPropagation()}).append('<span class="squares-hotel-styleline"></span>'),e.el.parent().bind("mouseleave",function(){clearTimeout(a);a=setTimeout(function(){e.hide(),e.el.removeClass("squares-focus-hover-style")},400)}).bind("mouseenter",function(){clearTimeout(a)}),$(".squares-hotel-calendar").click(function(a){a.stopPropagation()})},onSelectDate:function(b,c){if(c.css("color","#666").removeClass("squares-focus-hover-style"),c.attr("data-val",b),c.hasClass("start-date")){var d=c.parents(".select-date").find(".end-date");var e=d.parents(".hotel-content").index();d.val("").removeAttr("data-val"),p[e].setBeginDate(a.getBeforeDay(b).replace(/\-/g,"/")),setTimeout(function(){d.trigger("click")},300)}c.hasClass("end-date")&&""==c.parents(".hotel-content").find(".select-area").val()&&c.parents(".hotel-content").find(".select-area").trigger("click")},onShow:function(a){a.addClass("squares-focus-hover-style");var b=e.calendar;b.find("thead").each(function(){$(this).find("tr").eq(1).addClass("calendar-date")});var c=a.offset().left;var d=b.outerWidth();var f=c-10-d+190;b.css({left:f+"px"});var g=b.offset().top-$(document).scrollTop()+b.outerHeight();var h=$(window).height();g-h>10&&$("html,body").stop(!0,!0).animate({scrollTop:$(document).scrollTop()+g-h+30},500)}});$(this).hasClass("end-date")&&p.push(e)}catch(f){}}),a},goToLink:function(a){var b=this;var c="";"gn"==a&&b.valid("gn")&&(c="//hotel.jd.com/search.html?hq.cityId="+k.city.attr("data-val")+"&hq.arriveDate="+k.start.attr("data-val")+"&hq.leaveDate="+k.end.attr("data-val"),"\u9152\u5e97/\u5546\u5708/\u5730\u6807"!=k.area.val()&&""!=k.area.val()&&(c+="&hq.keyWord="+encodeURI(k.area.val()))),""!=c&&window.open(c,"_blank")},valid:function(a){var b=this;if("gn"==a){if(!k.city.val())return alert(t.NODEST),k.city.click(),!1;var d=k.city.attr("data-choose");var e="";if(e=d!=k.city.val()?b.getCityID("gn"):k.city.attr("data-val"),""==e)return alert(t.ERRDEST),k.city.click(),!1;if(void 0==k.start.attr("data-val")||void 0==k.end.attr("data-val"))return""==k.start.val()||void 0==k.start.attr("data-val")?k.start.click():(""==k.end.val()||void 0==k.end.attr("data-val"))&&k.end.click(),!1;var f=k.start.attr("data-val");var g=k.end.attr("data-val");if(void 0!==f){f=f.replace(/\-/g,"/"),g=g.replace(/\-/g,"/");var h=b.compareDate(f,g);if("OK"!=h)return alert(t[h]),!1}}return!0},initAds:function(){var a=this;return window.SQUARES_HOTEL={},$.ajax({type:"get",url:"//fa.jd.com/loadFa_toJson.js?aid=0_0_8954-0_0_8955-0_0_8956-0_0_8900",dataType:"script",success:function(){g.find(".gn-word-ad").html(SQUARES_HOTEL.gnword),g.find(".gj-word-ad").html(SQUARES_HOTEL.gjword),g.find(".ad-left-img").html(SQUARES_HOTEL.leftimg),g.find(".ad-right-img").html(SQUARES_HOTEL.rightimg)},error:function(){}}),a},setCityID:function(a){var b=this;if("gn"==a){var c=$.trim(k.city.attr("data-val"));if(!c){var d=k.city.val();var e=b.hasCity(d,0);c=e?e:"",k.city.attr("data-val",c),""!=c&&k.city.attr("data-choose",d)}}return b},getCityID:function(a){var b=this;if("gn"==a){var c="";var d=$.trim(k.city.val());if(""==d)return"";var e=b.hasCity(d,0);return c=e?e:"",k.city.attr("data-val",c),k.city.attr("data-choose",d),c}},hasCity:function(a,b){var c=null;var d=n;var e=d.length;if(a&&d.length)for(;e--;)if(c=d[e],a==c[1]||a==c[2])return 1==b?c[1]:c[0];return!1},compareDate:function(a,b){var c=new Date;var d=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate();var e=this.convertTimeStamp(d);var f=this.convertTimeStamp(a);var g=this.convertTimeStamp(b);var h=(f-e)/1e3/24/60/60;var i=(g-f)/1e3/24/60/60;return i>20?"MORE28":h>=60?"MORE60":"OK"},convertTimeStamp:function(a){return new Date(a).getTime()},getBeforeDay:function(a){var b=c.str2Date(a);var d=b.getTime();return d=new Date(d),c.date2Str(d)},getNextDay:function(a,b){var d=c.str2Date(a);var e=d.getTime()+864e5*(b||1);return e=new Date(e),c.date2Str(e)}};var t={ERRDEST:"\u8be5\u57ce\u5e02\u4e0d\u5b58\u5728\uff0c\u8bf7\u60a8\u91cd\u65b0\u9009\u62e9\uff01",NODEST:"\u8bf7\u9009\u62e9\u76ee\u7684\u5730",MORE28:"\u5982\u679c\u60a8\u9700\u8981\u5728\u9152\u5e97\u5165\u4f4f20\u5929\u4ee5\u4e0a\uff0c\u8bf7\u81f4\u7535\u4eac\u4e1c\u5ba2\u670d\uff1a400-611-5718\u8fdb\u884c\u9884\u8ba2\uff0c\u6211\u4eec\u5c06\u4f1a\u7aed\u8bda\u4e3a\u60a8\u670d\u52a1\u3002",MORE60:"\u975e\u5e38\u62b1\u6b49\uff0c\u6211\u4eec\u6682\u65f6\u53ea\u63d0\u4f9b\u672a\u676560\u5929\u7684\u9152\u5e97\u4ef7\u683c\u6570\u636e\u67e5\u8be2\uff0c\u9884\u8ba2\u8bf7\u60a8\u4fee\u6539\u65e5\u671f\u540e\u91cd\u65b0\u67e5\u8be2\u3002"};a.init=r});
