define("home/widget/head_setUserInfo",function(require,exports,module){var e=require("load_async"),i=require("conf");pageConfig.loginDefer=new $.Deferred,pageConfig.userInfoDefer=new $.Deferred;var t=function(e){$.each(["$con","$btnp","$btnn"],function(i,t){e[t]instanceof $||(e[t]=0===i?$(e[t]):$(e[t],e.$ctn))}),this.opts={},$.extend(this,new _.Events),$.extend(this.opts,{},e),this._pageSize=e.pageSize||e.$ctn.width(),this._slideSize=e.slideSize||e.$con.width(),this._windowSize=e.windowSize||e.$ctn.width(),this._pageNow=0,this._pos=0,this._toPos=0,this._pageCnt=this._slideSize/this._pageSize,this._pagePerWindow=this._windowSize/this._pageSize};t.prototype=$.extend({},_.Events.prototype),t.prototype.init=function(){this.opts.infinite&&(this._fakeDom=this.opts.$con.children().clone(),this.opts.$con.append(this._fakeDom).css("width",2*this._slideSize+"px")),this._bind()},t.prototype._bind=function(){var e,i=this;e=function(e){return function(){i.opts.$con.is(":animated")||e()}},this.opts.$btnp.bind("click",e(function(){i._prev()})),this.opts.$btnn.bind("click",e(function(){i._next()}))},t.prototype._switchTo=function(e){var i=this;this.opts.$con.stop().animate({left:-e*this._pageSize+"px"},this.opts.speed,function(){i._pos=-e*i._pageSize})},t.prototype._next=function(){var e=this._pageNow+1;if(this.opts.infinite)e>2*this._pageCnt-this._pagePerWindow-.01&&(e-=this._pageCnt,this.opts.$con.css("left",this._pos+this._slideSize)),this._pageNow=e;else{if(e>this._pageCnt-.01)return;this._pageNow=e%this._pageCnt}this._switchTo(this._pageNow)},t.prototype._prev=function(){if(!this.opts.$con.is(":animated")){var e=this._pageNow-1;if(this.opts.infinite)e<-.01&&(e=this._pageCnt+e,this.opts.$con.css("left",this._pos-this._slideSize)),this._pageNow=e;else{if(e<-.01)return;this._pageNow=(this._pageCnt+e)%this._pageCnt}this._switchTo(this._pageNow)}};var s=function(e){var i={};this.opts=$.extend({},i,e)};s.prototype.init=function(){var t=this;e({url:i.INTERFACE.USER_NAME,timeout:1e3,params:{pin:this.pin,uuid:this.uuid},scriptCharset:"gb2312",jsonpCallback:"jsonpCallbackHelloService"}).then(function(e){e&&(t._setUsername(e),t._sso(e),t._setPop())})},s.prototype._setUsername=function(e){if(e.nick){var i=this.opts.$userName;if(i.html('<div class="dt cw-icon">        <i class="icon-plus-nickname"></i>        <i class="ci-right"><s>◇</s></i>        <a class="nickname" target="_blank" href="//home.jd.com/">'+e.nick+'</a>        <i class="iconfont">&#xe605;</i>      </div>      <div class="dd dorpdown-layer"></div>'),i.addClass("dorpdown").dropdown({enterDelay:100,trigger:!0,current:"hover",onchange:function(){createCookie("userInfo2016","1",1e4,"/"),$(".u-place-tip").hide()}}),!readCookie("userInfo2016")){var t=$('<div class="u-place-tip">          <i class="iconfont u-place-tip-ico">&#xe604;</i>          我的福利特权都在这里了哟～          <i class="iconfont u-place-tip-close J_utipclose">&#xe600;</i>        </div>').css("left",i.offset().left);_.eventCenter.on("home:resize",function(){t.css("left",i.offset().left)}),$(document.body).append(t),t.delegate(".J_utipclose","click",function(e){createCookie("userInfo2016","1",10,"/"),t.hide()})}}else this.opts.$userName.html(e.info)},s.prototype._sso=function(e){e.sso&&$.each(e.sso,function(e,i){$.getJSON(i)})},s.prototype._setPop=function(){var s,n,a,o,p=this;s={zymyf:{url:"//vip.jd.com/help.html#mypri-01",name:"自营免运费"},shfw:{url:"//vip.jd.com/help.html#mypri-02",name:"售后服务"},pjjl:{url:"//vip.jd.com/help.html#mypri-03",name:"评价奖励"},zjfw:{url:"//vip.jd.com/help.html#mypri-06",name:"装机服务"},hytj:{url:"//vip.jd.com/help.html#mypri-04",name:"会员特价"},srlb:{url:"//vip.jd.com/help.html#mypri-05",name:"生日礼包"},zxlb:{url:"//vip.jd.com/help.html#mypri-07",name:"专享礼包"},gbzx:{url:"//vip.jd.com/help.html#mypri-08",name:"贵宾专线"},yfq:{url:"//vip.jd.com/help.html#mypri-09",name:"运费券"}},n={1:[["zymyf","shfw","pjjl","zjfw"],["hytj","srlb","zxlb","gbzx","yfq"]],2:[["zymyf","shfw","pjjl","hytj","zjfw"],["srlb","zxlb","gbzx","yfq"]],3:[["zymyf","shfw","pjjl","hytj","srlb","zjfw"],["zxlb","gbzx","yfq"]],4:[["zymyf","shfw","pjjl","hytj","srlb","zxlb","zjfw"],["gbzx","yfq"]],5:[["zymyf","shfw","pjjl","hytj","srlb","zxlb","zjfw","gbzx","yfq"]]},a=function(e){var i=n[e]||n[5],t=i[0],a=i[1]||[],o=[];return $.each(t,function(e,i){var t=s[i];o.push('<div class="badge-panel"><a href="'+t.url+'" target="_blank"><i class="icobadage icobadage_'+i+'"></i><p class="u-name">'+t.name+"</p></a></div>")}),$.each(a,function(e,i){var t=s[i];o.push('<div class="badge-panel u-dis"><a href="'+t.url+'" target="_blank"><i class="icobadage icobadage_'+i+'"></i><p class="u-name">'+t.name+"</p></a></div>")}),o.join("")},e({url:i.INTERFACE.LOGIN_SERVICE,timeout:1e3,jsonpCallback:"jsonpCallbackIsLogin"}).then(function(e){pageConfig.loginDefer.resolve(e)},function(){pageConfig.loginDefer.resolve()}),pageConfig.loginDefer.then(function(t){t&&t.Identity&&t.Identity.IsAuthenticated?e({url:i.INTERFACE.USER_INFO,timeout:1e3,jsonpCallback:"jsonpCallbackRequestUserInfo"}).then(function(e){pageConfig.userInfoDefer.resolve(e)},function(){pageConfig.userInfoDefer.reject()}):pageConfig.userInfoDefer.reject()}),o=function(e){var i,s,n,o,l,e=e||{},c=e.imgUrl||"//misc.360buyimg.com/mtd/pc/common/img/no_login.jpg",r=e.userLevel||1,d=Number(e.plusStatus)||"5";switch(d){case 1:s='<a href="https://plus.jd.com/index" target="_blank">购买PLUS会员享更多特权 <span class="style-red">购买</span></a>',n=!0,o="开通正式版";break;case 2:s='<a href="https://plus.jd.com/index" target="_blank">购买PLUS会员尊享顶级特权&gt;</a>',n=!1,o="开通正式版";break;case 3:s='<a href="https://sale.jd.com/act/Xno3MQRklCIm.html" target="_blank">PLUS专享商品每周更新&gt;</a>',n=!0,o="PLUS专享";break;case 4:s='<a href="https://plus.jd.com/index" target="_blank">续费PLUS送150元礼包 <span class="style-red">续费</span></a>',n=!1,o="PLUS续费";break;default:d=0,s='<a href="https://plus.jd.com/index" target="_blank">试用PLUS会员领免运费券&gt;</a>',n=!1,o="免费试用"}i='<div class="dd-spacer"></div>        <div class="userinfo">          <div class="u-pic">            <a target="_blank" href="//home.jd.com/">              <img class="J_upic_img" src="//misc.360buyimg.com/mtd/pc/common/img/no_login.jpg" width="60" height="60" />            </a>          </div>          <div class="u-plus">            <a href="https://passport.jd.com/uc/login?ltype=logout" class="link-logout">退出</a>            <a href="https://plus.jd.com/index" target="_blank" class="icon-plus-dropdown"></a>          </div>          <div class="u-msg">'+s+"</div>        </div>",l='<div class="badge-list J_sliderwrap">        <a href="javascript:void(0);" class="badge-list-prev J_slider_btnp"><i class="iconfont">&#xe602;</i></a>        <div class="u-badges J_slider_ctn">          <div class="badge-panel-main J_slider_con">            <div class="badge-panel fore1'+(n?"":" u-dis ")+'">              <a href="https://plus.jd.com/index" target="_blank">                <i class="icobadage icobadage_plus"></i>                <p class="u-name">'+o+"</p>              </a>            </div>"+a(r)+'</div>        </div>        <a href="javascript:void(0);" class="badge-list-next J_slider_btnn"><i class="iconfont">&#xe601;</i></a>      </div>',$(".dd",p.opts.$userName).html(i+l);var h=$(".J_sliderwrap",p.opts.$userName);_.eventCenter.on("home:load",function(){$(".J_upic_img").attr("src",c)}),new t({$ctn:$(".J_slider_ctn",h),$con:$(".J_slider_con",h),$btnp:$(".J_slider_btnp",h),$btnn:$(".J_slider_btnn",h),pageSize:140,windowSize:210,infinite:!1,speed:200}).init(),p.opts.$userName.addClass("icon-plus-state"+d)},pageConfig.userInfoDefer.then(function(e){o(e)},function(){o()})},module.exports=s});