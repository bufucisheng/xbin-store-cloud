define("home/widget/slider",["HOME_BASE/carousel.js","HOME_BASE/util.js"],function(require){"use strict";var t=require("HOME_BASE/carousel.js"),e=require("HOME_BASE/util.js"),i=require("conf"),a=require("load_async"),r=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),this.width=790,this.isWide=pageConfig.compatible&&pageConfig.wideVersion,this.init()},init:function(){this.buildCarouselDom(),this.buildBottom(),this.initEvent()},buildCarouselDom:function(){var t=this,e=[],r=window,o=i.INTERFACE.FOCUS;a({url:o,needStore:!0,times:0,timeout:1e3,backup:r.pageConfig.o2JSConfig.backupPathRule("focus"),dataCheck:function(t){return!(!t.data||!$.isArray(t.data))},jsonpCallback:"jsonpCallbackFocus",storeSign:r.sourceVersion.focus}).then(function(i){i.data&&$.isArray(i.data)&&(e=i.data,t.createCarsouelDom(e))})},createCarsouelDom:function(t){for(var e="",i="",a=this.conf.$el,r=a.find(".J_slider_list"),o=0;o<t.length;o++){var s=t[o];if(s&&s.length){var n=s.length;if(n){s=pageConfig.FN_GetRandomData(s),pageConfig.clog.logDomain=s.logDomain,pageConfig.clog.logV=s.logV;var l=this.isWide?s.src:s.srcB;e+='<li class="J_slider_item slider_item">                <a href="'+s.href+'" class="slider_item_lk mod_loading" fclog="'+s.clog+'" clstag="'+pageConfig.clstagPrefix+"08a"+(o>10?o+2:"0"+(o+2))+'" target="_blank">                  <img data-lazy-src="'+l+'" alt="'+s.alt+'" src="//misc.360buyimg.com/mtd/pc/common/img/blank.png" class="J_slider_item_img slider_item_img" />                </a>              </li>'}}}var c=r.length>0;c||(i='<ul class="slider_list J_slider_list">'+e+'</ul>          <div class="J_slider_indicator slider_indicator"></div><a href="javascript:void(0)" clstag="" class="J_slider_control_prev slider_control_item slider_control_prev"><i class="iconfont">&#xe602;</i></a><a href="javascript:void(0)" clstag="" class="J_slider_control_next slider_control_item slider_control_next"><i class="iconfont">&#xe601;</i></a>',$(".J_slider_main",a).append(i).removeClass("mod_lazyload")),r.append(e),this.initCarousel(),this.initCarouselNav(),this.changeRTB();var d=r.find("[fclog]");d.length&&_.eventCenter.on("home:load",function(){pageConfig.sendClog(d)})},changeRTB:function(){var t=2382;pageConfig.wideVersion||(t=2433);var e=$(".J_slider_main .J_slider_item",this.conf.$el),i=e.eq(e.length-1);if(!i.length)return!1;var a=this;$.getJSON("//x.jd.com/focus?spread_type=1&ad_type=10&template=0&ad_ids="+t+":1&callback=?",function(r){if(r&&$.isArray(r[t])&&r[t].length){var o=r[t][0];$("a:eq(0)",i).attr("href",o.click_url.replace(/^http(s?):/,"")),o.image_url="//img13.360buyimg.com/da/"+o.image_url;var s=$("a:eq(0) img",i);a.carousel.getCurrent()===e.length-1?s.removeAttr("data-lazy-src").attr("src",o.image_url):s.attr("data-lazy-src",o.image_url).attr("src","//misc.360buyimg.com/mtd/pc/common/img/blank.png"),function(){var t=!1;$(window).bind("load",function(){t||(t=!0,(new Image).src=o.exposal_url)})}()}})},buildBottom:function(){var t=pageConfig.focusBottomData||[],e=this;if(t.isTop)e.createBottomDom(t.data);else{var r=readCookie("pin")||"";r=decodeURIComponent(r),a({url:i.INTERFACE.FOCUS_BOTTOM_REC,params:{pin:r,uuid:readCookie("__jda")||-1,lid:readCookie("areaId")||"1",lim:2,ec:"utf-8"},jsonpCallback:"jsonpCallbackFocusBottomRec",times:0,timeout:1e3}).then(function(i){if(i&&i.success&&i.data){var a=i.data,r=t.data;a&&a.length?a.length<2&&r.length&&a.push(r[0]):a=r,e.createBottomDom(a),_.eventCenter.on("home:load",function(){var t=i.impr;if(t){e.monitor(i.impr);var r=i.impr.indexOf("$csku=");r>-1&&(t=i.impr.substring(0,r+6)+"{j_csku}",t+=i.impr.substring(i.impr.indexOf("$",r+6)));var o=[];if(a&&a.length)for(var s=0;s<a.length;s++){var n=a[s].sku;$.trim(n)&&o.push(a[s].sku)}if(o.length){var l=t.replace("action=0","action=2$index=0").replace("{j_csku}",o.join(","));e.monitor(l)}}})}else e.createBottomDom(t.data);_.eventCenter.on("home:load",function(){e.errorMonitor(i)})},function(i,a){e.createBottomDom(t.data),_.eventCenter.on("home:load",function(){e.errorMonitor(null,a)})})}},createBottomDom:function(t){var e="",i=this,a=i.conf.$el;if(t&&t.length)for(var r=0;r<2;r++){var o=t[r],s=o.t.replace(/^http(s?):/,""),n=["b","c"],l="";if(/\/\//.test(o.img))l=o.img;else{var c=String(o.sku).match(/(\d)$/)?o.sku:"11";l=pageConfig.FN_GetImageDomain(c)+o.img}l=pageConfig.processImageUrl(l,"780x260","390x130"),/\!q/.test(l)||(l+="!q90"),e+='<div class="J_slider_bi slider_bi" clstag="'+pageConfig.clstagPrefix+"08"+n[r]+'" data-clk="'+o.clk+'" data-sku="'+o.sku+'">            <a href="'+s+'" class="slider_bi_lk mod_loading" target="_blank">              <img data-lazy-src="'+l+'" class="J_slider_bi_img slider_bi_img" title="" alt="" src="//misc.360buyimg.com/lib/img/e/blank.gif" >            </a>          </div>'}$(".J_slider_extend",a).append(e).removeClass("mod_lazyload").find(".J_slider_bi_img").each(function(){var t=$(this);i.loadImage(t)})},monitor:function(t){if(t){var e=new Image;e.src=t+"&m=UA-J2011-1&ref="+encodeURIComponent(document.referrer)+"&random="+Math.random(),e=null}},errorMonitor:function(t,e){var a=i.INTERFACE.FOCUS_BOTTOM_REC_ERR_LOG;t?t.success?t.data&&t.data.length||this.monitor(a+"2"):this.monitor(a+"1"):"timeout"===e?this.monitor(a+"3"):this.monitor(a+"4")},initCarousel:function(){var e=this.conf.$el,i=e.find(".slider_list"),a=i.children().length;this.carousel=new t({container:i,itemSelector:".slider_item",activeClass:"slider_item_active",startIndex:0,duration:300,delay:3e3,zIndex:1,switchType:"fade",onFirstSwitch:$.proxy(function(t){var e=$(".J_slider_item",i).eq(t).find(".J_slider_item_img"),r=t+1;r===a&&(r=0);var o=$(".J_slider_item",i).eq(r).find(".J_slider_item_img");this.loadImage(e),this.loadImage(o)},this),onBeforeSwitch:$.proxy(function(t,e){this.switchCarouselNav(e)},this)})},loadImage:function(t){if(t.length){var e=t.data("lazy-src");e&&e.length&&t.attr("src",e).one("load",function(){$(this).removeAttr("data-lazy-src").parent().removeClass("mod_loading")}).each(function(){this.complete&&$(this).load()})}},initEvent:function(){var t=this;this.conf.$el.delegate(".slider_indicator_btn","mouseenter",e.throttle(function(){var e=t.carousel,i=$(this).index();e.stop(),i!==e.getCurrent()&&($(this).siblings().removeClass("slider_indicator_btn_active").end().addClass("slider_indicator_btn_active"),e.switchTo(i))},500)).delegate(".J_slider_bottom_btn[data-clk]","click",function(){var e=$(this);t.monitor(e.data("clk"))}).delegate(".J_slider_control_prev","click",$.proxy(this.prevCarousel,this)).delegate(".J_slider_control_prev","mouseenter",function(){var e=t.carousel;e.stop(),t.restartCarousel()}).delegate(".J_slider_control_next","click",$.proxy(this.nextCarousel,this)).delegate(".J_slider_control_next","mouseenter",function(){var e=t.carousel;e.stop(),t.restartCarousel()})},prevCarousel:function(t){t&&t.preventDefault(),this.carousel.stop().switchToPrev(),this.restartCarousel()},nextCarousel:function(t){t&&t.preventDefault();this.carousel;this.carousel.stop().switchToNext(),this.restartCarousel()},restartCarousel:function(){var t=this.carousel;clearTimeout(this.restartTimer),this.restartTimer=setTimeout(function(){t.start()},4e3)},initCarouselNav:function(){for(var t=this.carousel.length,e=[],i=0;i<t;i++){var a=null,r="";i===t-1?a="slider_indicator_btn_last":0===i&&(a="slider_indicator_btn_active"),a="string"==typeof a?" "+a:"",r='<i class="slider_indicator_btn'+a+'"></i>',e.push(r)}var o=this.conf.$el.find(".J_slider_indicator");o.html(e.join("")).css("marginLeft",-o.outerWidth()/2+"px").show()},switchCarouselNav:function(t){var e=$(this.conf.$el.find(".slider_indicator_btn").get(t));e.siblings().removeClass("slider_indicator_btn_active").end().addClass("slider_indicator_btn_active")}});return r});