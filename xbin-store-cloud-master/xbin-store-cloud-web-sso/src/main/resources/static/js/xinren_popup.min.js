"use strict";function showXRDialog(t,o,e){var i=$("#J_rxdlog").length>0?$("#J_rxdlog"):$('<div id="J_rxdlog" class="J_rxdlog rxdlog" style="position:absolute;z-index:997;top:0;left:-9999px;*width:800px;"><iframe name="xr_iframe" src="'+t+'" frameborder="0" scrolling="no" id="xr_iframe" onload="javascript:xrAutoIframe(this);" width="100%" allowTransparency="true" /></div>'),n=navigator.userAgent;/msie (6|7)/i.test(n)&&i.css("left",0),i.appendTo("body"),window.xd=new xrDialog({el:i,closeHook:".xinren_dialog_close,.xinren_dialog_button,.xrpopup_close,.j_xrclose",offsetTop:0,addHeight:i.hasClass("xrpopup")?240:0,onShow:function(){i.addClass("rxdlog_animate")},onResize:function(t){i.height()>$(window).height()&&t&&i.css({top:25+$(document).scrollTop()})},onClose:function(){o&&o()},onBeforeClose:function(t){var o={opacity:0};return e&&(o={left:e.offset().left+.5*e.width()-.5*i.width(),top:e.offset().top+.5*e.height()-.5*i.height(),opacity:0}),i.removeClass("rxdlog_animate").addClass("rxdlog_animateout").animate(o,function(){return t.resolve()}),t}})}function showXRDialogByType(t){var o=t||o2util.getUrlParam("channel");showXRDialog(XRURL.XRPOPUP_URL+"&channel="+o)}function xrAutoIframe(t){var o=t?$(t):$("#xr_iframe");o.removeAttr("style");var e=t.contentWindow.document.documentElement,i=e.scrollHeight,n=e.scrollWidth;o.css({width:n,height:i}),"xr_iframe"===o.attr("id")&&(o.parent().css({width:n,height:i}),window.xd.show())}function showDialogByType(t,o,e){seajs.use(XRURL.DIALOG_TPL,function(i){var n=$('div[data-type="'+t+'"]').length>0?$('div[data-type="'+t+'"]'):$(i[t]);if(0!==n.length){n.appendTo("body"),n.css({position:"absolute",zIndex:999});var s=new xrDialog({el:n,closeHook:".xinren_dialog_close,.xinren_dialog_button,.xrpopup_close,.j_xrclose",offsetTop:n.hasClass("xrpopup")?150:0,addHeight:n.hasClass("xrpopup")?240:0,onShow:function(){n.addClass("rxdlog_animate"),o&&o(n)},onClose:function(){e&&e(n)},onBeforeClose:function(t){return n.removeClass("rxdlog_animate").addClass("rxdlog_animateout").animate({opacity:0},function(){return t.resolve()}),t}});s.show(),"win_p_6"===t&&($(".xrpopup_rule").tinyscrollbar(),log&&log("xinren_09","overlay",2,10,1))}})}function showFormMsg(t,o,e){"succ"===o?t.find(".xrpopup_form_msg_succ").html('<i class="xrpopup_icon_succ"></i> '+e).show().siblings().hide():t.find(".xrpopup_form_msg_err").html('<i class="xrpopup_icon_error"></i> '+e).show().siblings().hide()}function autoPopup(){var t=o2util.getUrlParam("channel");$.ajax({type:"GET",url:XRURL.CHECK_NEWUSER_API+"&channel="+t,dataType:"jsonp",success:function(o){"success"==o.status&&showXRDialog(XRURL.XRPOPUP_URL+"&channel="+t)},error:function(t){showDialogByType("win_p_4",function(t){t.find(".xinren_dialog_button").attr("href",location.href)})}})}var XRURL={DIALOG_TPL:"//static.360buyimg.com/mtd/pc/xinren/popup/js/dialogTpl.js",SEND_SMS_API:"//xinrenlayer.jd.com/layer/coupon?action=sendSmsCode",VERIFY_SMS_API:"//xinrenlayer.jd.com/layer/coupon?action=smsVarify",VERIFY_MOBILE_API:"//xinrenlayer.jd.com/layer/coupon?action=phone_varify",CHECK_NEWUSER_API:"//xinrenlayer.jd.com/layer/coupon?action=isNewuser",XRPOPUP_URL:"//xinrenlayer.jd.com/layer/coupon?action=not_get"},XRMSG={SMS_ERROR:"验证码错误！",SMS_SEND_FAIL:"验证码发送失败，请60秒后重试！",MOBILE_ERROR:"手机号错误！",SMS_READY_SEND:"验证码已发，请注意查收。",MOBILE_OK:"手机号正确！",MOBILE_OR_SMS_ERROR:"手机号或验证码错误！",SMS_REQUIRE:"请输入验证码！",SMS_LEN:"请输入6位验证码！",MOBILE_REQUIRE:"请输入手机号！",NUMBER_REQUIRE:"请输入数字！",MOBILE_LEN:"请输入11位手机号码！"},xrDialog,o2util=o2util||{};$.extend(o2util,{PValidate:function(t){var o=t.is("form")?t.find(":input[validate]"):t,e=!0,i=function(t,o){var t=t.match(/(\w+)(\[(.+)\]$)?/),e=t[3];switch(t[1]){case"require":return""!=o.replace(/^\s+|\s+$/,"");case"num":return/^\d+$/.test(o);case"len":return o.length==e;case"email":return/^[a-z0-9._%-]+@[a-z0-9.-]+\.[a-z]{2,4}$/i.test(o);case"eq":return o==$(":input[name="+e+"]").val();case"gt":return o.length>e;case"reg":return new RegExp(e).test(o)}};return o.each(function(){for(var t=$(this).attr("validate").split($(this).data("split")||"##"),o=0,n=t.length;o<n;o++){var s=t[o].split("|"),r=$(this);if(!i(s[0],r.val())){showFormMsg(r.parent(),"err",s[1]),e=!1;break}}}),!!e},getUrlParam:function(t){var o=new RegExp("(\\?|#|&)"+t+"=([^&#]*)(&|#|$)"),e=location.href.match(o);return e?e[2]:""}}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){function o(o,n){function s(){return f.update(),a(),f}function r(){x.css(M,f.thumbPosition),_.css(M,-f.contentPosition),w.css(b,f.trackSize),S.css(b,f.trackSize),x.css(b,f.thumbSize)}function a(){g&&(m[0].ontouchstart=function(t){1===t.touches.length&&(t.stopPropagation(),h(t.touches[0]))}),x.bind("mousedown",function(t){t.stopPropagation(),h(t)}),S.bind("mousedown",function(t){h(t,!0)}),f.options.wheel&&window.addEventListener?o[0].addEventListener(R,l,!1):f.options.wheel&&(o[0].onmousewheel=l)}function c(){return f.contentPosition>0}function u(){return f.contentPosition<=f.contentSize-f.viewportSize-5}function h(o,i){f.hasContentToSroll&&(t("body").addClass("noSelect"),$=i?x.offset()[M]:v?o.pageX:o.pageY,g&&(document.ontouchmove=function(t){(f.options.touchLock||c()&&u())&&t.preventDefault(),t.touches[0][e+"Touch"]=1,d(t.touches[0])},document.ontouchend=p),t(document).bind("mousemove",d),t(document).bind("mouseup",p),x.bind("mouseup",p),S.bind("mouseup",p),d(o))}function l(e){if(f.hasContentToSroll){var i=e||window.event,n=-(i.deltaY||i.detail||-1/3*i.wheelDelta)/40,s=1===i.deltaMode?f.options.wheelSpeed:1;f.contentPosition-=n*s*f.options.wheelSpeed,f.contentPosition=Math.min(f.contentSize-f.viewportSize,Math.max(0,f.contentPosition)),f.thumbPosition=f.contentPosition/f.trackRatio,o.trigger("move"),x.css(M,f.thumbPosition),_.css(M,-f.contentPosition),(f.options.wheelLock||c()&&u())&&(i=t.event.fix(i),i.preventDefault())}e&&e.stopPropagation()}function d(t){if(f.hasContentToSroll){var i=v?t.pageX:t.pageY,n=t[e+"Touch"]?$-i:i-$,s=Math.min(f.trackSize-f.thumbSize,Math.max(0,f.thumbPosition+n));f.contentPosition=s*f.trackRatio,o.trigger("move"),x.css(M,s),_.css(M,-f.contentPosition)}}function p(){f.thumbPosition=parseInt(x.css(M),10)||0,t("body").removeClass("noSelect"),t(document).unbind("mousemove",d),t(document).unbind("mouseup",p),x.unbind("mouseup",p),S.unbind("mouseup",p),document.ontouchmove=document.ontouchend=null}this.options=t.extend({},i,n),this._defaults=i,this._name=e;var f=this,m=o.find(".viewport"),_=o.find(".overview"),w=o.find(".scrollbar"),S=w.find(".track"),x=w.find(".thumb"),g="ontouchstart"in document.documentElement,R="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",v="x"===this.options.axis,b=v?"width":"height",M=v?"left":"top",$=0;return this.contentPosition=0,this.viewportSize=0,this.contentSize=0,this.contentRatio=0,this.trackSize=0,this.trackRatio=0,this.thumbSize=0,this.thumbPosition=0,this.hasContentToSroll=!1,this.update=function(t){var o=b.charAt(0).toUpperCase()+b.slice(1).toLowerCase();if(this.viewportSize=m[0]["offset"+o],this.contentSize=_[0]["scroll"+o],0!=this.viewportSize||0!=this.contentSize){switch(this.contentRatio=this.viewportSize/this.contentSize,this.trackSize=this.options.trackSize||this.viewportSize,this.thumbSize=Math.min(this.trackSize,Math.max(this.options.thumbSizeMin,this.options.thumbSize||this.trackSize*this.contentRatio)),this.trackRatio=(this.contentSize-this.viewportSize)/(this.trackSize-this.thumbSize),this.hasContentToSroll=this.contentRatio<1,w.toggleClass("disable",!this.hasContentToSroll),t){case"bottom":this.contentPosition=Math.max(this.contentSize-this.viewportSize,0);break;case"relative":this.contentPosition=Math.min(Math.max(this.contentSize-this.viewportSize,0),Math.max(0,this.contentPosition));break;default:this.contentPosition=parseInt(t,10)||0}return this.thumbPosition=this.contentPosition/this.trackRatio,r(),f}},s()}var e="tinyscrollbar",i={axis:"y",wheel:!0,wheelSpeed:40,wheelLock:!0,touchLock:!0,trackSize:!1,thumbSize:!1,thumbSizeMin:20};t.fn[e]=function(i){return this.each(function(){t.data(this,"plugin_"+e)||t.data(this,"plugin_"+e,new o(t(this),i))})}}),define("xinren/dialog",function(){var t=function(t){var o={el:null,mask:null,closeHook:"",onShow:null,onClose:null,onResize:null,offsetTop:0,addHeight:0,resizeThread:null,scrollThread:null,onBeforeClose:null};$.extend(this,o,t),this.init()};return t.prototype={init:function(){""!==this.closeHook&&$(this.closeHook,this.el).bind("click",$.proxy(this.hide,this)),$(window).bind("resize.xr",$.proxy(this.resize,this)),$(window).bind("scroll.xr",$.proxy(this.scroll,this))},show:function(){var t=this,o=t.el;return this.mask=this.mask||$('<div class="xrmask">').css({position:"fixed",left:0,top:0,width:"100%",height:$(document).height(),background:"#000",opacity:.7,display:"none",zIndex:o.css("zIndex")-1}).bind("click",function(){}).appendTo("body"),o.show(),this.mask.show(),this.doResize(!0),this.onShow&&this.onShow(),this},scroll:function(){var t=this;clearTimeout(t.scrollThread),t.scrollThread=setTimeout(function(){$(t.mask).css({width:$(document).width(),height:$(document).height()})},200)},resize:function(){var t=this;return clearTimeout(t.resizeThread),t.resizeThread=setTimeout(function(){t.doResize()},50),this},doResize:function(t){var o=this,e=o.el;return t?e.css({left:.5*($(window).width()-e.outerWidth(!0)),top:.5*($(window).height()-(e.outerHeight(!0)+o.addHeight))+$(document).scrollTop()+o.offsetTop}):e.css({left:.5*($(window).width()-e.outerWidth(!0))}),$(o.mask).css({width:$(window).width(),height:$(document).height()}),o.onResize&&o.onResize(t),this},hide:function(){var t=this;if(t.onBeforeClose){var o=$.Deferred();$.when(t.onBeforeClose(o)).done(function(){t.doHide()})}else t.doHide();return this},doHide:function(){return this.el.hide().remove(),$(this.mask).hide().remove(),this.onClose&&this.onClose(),this},destory:function(){return $(this.mask).remove(),this}},t}),define("xinren/countdown",function(){var t=function(t){var o={cid:null,count:0,times:5,onFinish:null,onTick:null,auto:!0};$.extend(this,o,t),this.auto&&this.init()};return t.prototype={init:function(){this.reset(),this.start()},start:function(){var t=this;t.stop(),t.tick(),t.cid=setInterval(function(){t.tick()},1e3)},tick:function(){this.count--,this.onTick&&this.onTick(this.count),0===this.count&&(this.onFinish&&this.onFinish(),this.stop())},restart:function(){this.reset(),this.start()},reset:function(){this.count=this.times,this.stop()},stop:function(){clearInterval(this.cid)}},t}),define("xinren/popup",function(t){if(xrDialog=t("xinren/dialog"),window.self!=window.top&&window.parent.xd){$(".xinren_dialog_close,.xinren_dialog_button,.xrpopup_close,.j_xrclose").bind("click",function(t){window.parent.xd.hide()}),$(document).height()>$(window.parent).height()&&$(".xrpopup_tip").show();var o=$(".xrpopup"),e=t("xinren/countdown");switch(o.data("type")){case"win_p_2a":var i=$(".xrpopup_form_resend"),n=$(".xrpopup_form_msg"),s=$(".xrpopup_form_text"),r=$('input[name="scode"]'),a=$(".xrpopup_buy4"),c=$(".xrpopup_form"),u=new e({times:60,onTick:function(t){i.html(t+"秒后重发")},onFinish:function(){i.addClass("xrpopup_form_btnbk").html("获取验证码")}}),h=function(){n.find("div").hide(),o2util.PValidate(s)&&$.ajax({type:"GET",url:XRURL.VERIFY_SMS_API,dataType:"json",data:{smsCode:s.val(),scode:r.val()||""},success:function(t){t.status&&""!==t.url?location.href=t.url:showFormMsg(n,"err",XRMSG.SMS_ERROR)}})};s.attr("validate","require|"+XRMSG.SMS_REQUIRE+"##len[6]|"+XRMSG.SMS_LEN),c.find(":input[validate]").blur(function(){if(o2util.PValidate($(this)))return!1}).focus(function(){n.find("div").hide()}),i.bind("click",function(){var t=$(this);t.hasClass("xrpopup_form_btnbk")&&$.getJSON(XRURL.SEND_SMS_API,function(o){"success"==o.status?showFormMsg(n,"succ",XRMSG.SMS_READY_SEND):showFormMsg(n,"err",XRMSG.SMS_SEND_FAIL),u.restart(),t.removeClass("xrpopup_form_btnbk")})}),a.bind("click",function(){h()});break;case"win_p_2b_2":var i=$(".xrpopup_form_resend"),a=$(".xrpopup_buy4"),l=$(".xrpopup_form_text"),d=$(".xrpopup_form_longtext"),r=$('input[name="scode"]'),c=$(".xrpopup_form").find("form"),u=new e({times:60,auto:!1,onTick:function(t){i.html(t+"秒后重发")},onFinish:function(){i.addClass("xrpopup_form_btnbk").html("获取验证码")}});l.attr("validate","require|"+XRMSG.SMS_REQUIRE+"##len[6]|"+XRMSG.SMS_LEN),d.attr("validate","require|"+XRMSG.MOBILE_REQUIRE+"##num|"+XRMSG.NUMBER_REQUIRE+"##len[11]|"+XRMSG.MOBILE_LEN),c.find(":input[validate]").blur(function(){var t=$(this).parent().find("xrpopup_form_msg");o2util.PValidate($(this))&&$(this).is(d)&&$.ajax({type:"GET",url:XRURL.VERIFY_MOBILE_API,dataType:"json",data:{mobileNum:d.val()},success:function(o){"F6"==o.status?showFormMsg(t,"err",XRMSG.MOBILE_ERROR):"0"==o.status&&showFormMsg(t,"succ",XRMSG.MOBILE_OK)},error:function(o){showFormMsg(t,"err",XRMSG.MOBILE_ERROR)}})}).focus(function(){$(this).parent().find(".xrpopup_form_msg div").hide()}),i.bind("click",function(){var t=$(this),o=d.val(),e=$(this).parent().find(".xrpopup_form_msg");o2util.PValidate(d)&&t.hasClass("xrpopup_form_btnbk")&&$.getJSON(XRURL.SEND_SMS_API,{mobileNum:o},function(o){"success"==o.status?showFormMsg(e,"succ",XRMSG.SMS_READY_SEND):showFormMsg(e,"err",XRMSG.SMS_SEND_FAIL),u.restart(),t.removeClass("xrpopup_form_btnbk")})}),a.bind("click",function(){l.parent().find(".xrpopup_form_msg");o2util.PValidate(c)&&$.ajax({type:"GET",url:XRURL.VERIFY_SMS_API,dataType:"json",data:{mobileNum:d.val(),smsCode:l.val(),scode:r.val()||""},success:function(t){t.status&&""!==t.url?location.href=t.url:window.parent.showDialogByType("win_p_4",function(t){t.find(".mod_popup_warn").html(XRMSG.MOBILE_OR_SMS_ERROR),t.find(".xinren_dialog_button").text("确定")})},error:function(t){window.parent.showDialogByType("win_p_4")}})})}}else location.href.indexOf("reg.jd.com")===-1&&autoPopup()}),seajs.config({charset:function(t){return"utf-8"}}),seajs.use("xinren/popup");