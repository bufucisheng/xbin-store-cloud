/*!Name: ELazyload.js
 * Date: 2017-2-14 17:14:16 */
define("MOD_ROOT/js/ELazyload",function(require,exports,module){"use strict";function t(t,i){this.$el=t,this.settings=$.extend({},n,i),this._defaults=n,this._name=e,this._version=s,this._guid=t.data("Eguid"),this.init()}var e="ELazyload",s="@VERSION",i=function(){},n={delay:100,type:"img",source:"data-src",removeSource:!0,threshold:100,loadingClass:"ELazy-loading",errorClass:"ELazy-error",debug:!1,placeholder:["//misc.360buyimg.com/lib/img/e/blank.gif","//misc.360buyimg.com/lib/img/e/blank.gif","data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEHAAIALAAAAAABAAEAAAICVAEAOw=="],onAppear:i,onReady:i,onComplete:i,onError:i,onLoad:i};t.prototype={init:function(){"img"===this.settings.type?this.$targets=this.$el.eq(0).is("img")?this.$el:this.$el.find("["+this.settings.source+"]"):this.$targets=this.$el,this._eventString="scroll.lazyload."+this._guid+" resize.lazyload."+this._guid,this.$w=$(window),this.total=this.$targets.length,this.timer=null,this.isCheckable=!0,this.loaded=[],this.bindEvent(),this.supportRect=this.supportClientRect(),this.check(this.$targets),this.settings.onReady.call(this)},supportDataURI:function(t){if(this.isSupportDataURI)return t(this.isSupportDataURI);var e=new Image;e.onload=e.onerror=function(){var e=1===this.width&&1===this.height?1:0;this.isSupportDataURI=e,t(e)},e.src=this.settings.placeholder[1]},bindEvent:function(t){var e=this;t&&"img"===this.settings.type?(t.get(0).onload=function(){e.onLoad(t)},t.get(0).onerror=function(){t.removeClass(e.settings.loadingClass).addClass(e.settings.errorClass),t.data("loaded",!1),e.supportDataURI(function(s){var i=e.settings.placeholder[s];t.attr("src",i),e.placeholder=i}),e.settings.onError.call(e,t)}):this.$w.unbind(this._eventString).bind(this._eventString,function(){e.handleCheck(e.$targets)})},onLoad:function(t){var e=t.attr("src");e!==this.settings.placeholder[0]&&e!==this.settings.placeholder[1]&&(t.removeClass(this.settings.loadingClass),t.data("loaded",!0),this.loaded.push(1),this.settings.onLoad.call(this,t))},handleCheck:function(t){var e=this;this.isCheckable&&(this.isCheckable=!1,this.timer=setTimeout(function(){e.check(t),e.isCheckable=!0},this.settings.delay))},check:function(t){function e(t){t.data("loaded",!0),"img"===s.settings.type?(t.attr("src",t.attr(s.settings.source)),s.settings.removeSource&&t.removeAttr(s.settings.source)):t.removeClass(s.settings.loadingClass),s.settings.onAppear.call(s,t)}var s=this,i=$();t.each(function(){var t=$(this);t.data("loaded")||(t.addClass(s.settings.loadingClass),t.data("loaded",!!t.attr("src")),s.insertHolder(t),s.bindEvent(t));var n=s.$holder||t;s.inWindow(n)?e(t):i=i.add(t),s.settings.debug&&(t.next().is($(".img-status"))?t.next().html("Loaded: "+t.data("loaded")):t.after('<div class="img-status">Loaded: '+t.data("loaded")+"</div>"))}),this.$targets=i,this.placeholderAdded||"img"!==s.settings.type||this.setDefaultPlaceholder(i),this.settings.debug&&console.log("Total:"+this.total+"\u3000 current:"+t.length+"\u3000 Left: "+i.length),this.total===this.loaded.length&&(this.$w.unbind(this._eventString),this.settings.onComplete.call(this),this.settings.debug&&console.log("All done."))},setDefaultPlaceholder:function(t){var e=this;this.supportDataURI(function(s){for(var i=e.settings.placeholder[s],n=0,a=t.length;a>n;)t.get(n).setAttribute("src",i),n++;e.placeholderAdded=!0})},insertHolder:function(t){"img"!==this.settings.type&&(t.is(":visible")||t.prev().is(".Elazy-holder")||(t.before('<ins class="ELazy-holder ELazy-holder'+this._guid+'"></ins>'),this.$holder=t.prev(".ELazy-holder")))},supportClientRect:function(){if("undefined"!=typeof this.isSupportClientRect)return this.isSupportClientRect;var t=document.createElement("div"),e="getBoundingClientRect"in t;return t=null,this.isSupportClientRect=e,e},inWindow:function(t){var e=this.$w.height(),s=$("body").scrollTop()||$("html").scrollTop();if(this.supportRect){var i=t.get(0).getBoundingClientRect(),n=i.top,a=i.left,o=i.top+i.height;return n>=0&&a>=0&&n<=e+this.settings.threshold||0>n||o>=0&&a>=0&&e>=o}var n=t.offset().top,l=t.height(),o=n+l;return n<e+s+this.settings.threshold&&n>s||e+s>o&&o>s}},$.fn[e+"_guid"]=0,$.fn[e]=function(s){return this.length||"undefined"==typeof console?this.each(function(){$(this).data("Eguid",$.fn[e+"_guid"]++);var i=new t($(this),s),n=$(this).data(e);n?n.push(i):$(this).data(e,[i])}):(console.log("\u300c"+e+"\u300d The elements["+this.selector+"] you passed is empty."),this)}});
