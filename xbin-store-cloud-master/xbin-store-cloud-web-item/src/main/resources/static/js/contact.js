/*!Name: contact.js
 * Date: 2017-2-14 17:14:16 */
define("MOD_ROOT/js/contact",function(require,exports,module){function e(e,i){if(e.jimiData)return render(e.jimiData);var o={skuId:e.skuid,c1:e.cat[0],c2:e.cat[1],c3:e.cat[2],venderId:e.venderId};$.ajax({url:"//entry-jimi.jd.com/iadshop/checkJimiStatus?"+$.param(o),dataType:"jsonp",scriptCharset:"utf-8",cache:!0,success:function(o){/debug=im/.test(location.href)&&alert(o.code),e.jimiData=o,i(e.jimiData,o)}})}function i(e,i,o,t,n){var a='            <div class="jimi">                <a href="//jimi.jd.com/index.action?productId={0}&source={1}" target="_blank">                    <i class="sprite-jimi"></i>'+i+"                </a>            </div>";n&&e.html(a.format(o.skuid,o.isJd?"productself":"productpop"))}function o(e){new c({$wrap:$(".contact"),vids:[e.shopId],onFollow:function(){var i=readCookie("pin")||"",o=readCookie("__jda")?readCookie("__jda").split(".")[1]:"";G.sendRequest("//mercury.jd.com/log.gif?t=shop.100001&v=src=shop$shopid="+e.shopId+"$action=0&pin="+i+"&uid="+o+"&ver=1&rid="+Math.random()+"&m=UA-J2011-1&ref="+document.referrer)},onunFollow:function(){var i=readCookie("pin")||"",o=readCookie("__jda")?readCookie("__jda").split(".")[1]:"";G.sendRequest("//mercury.jd.com/log.gif?t=shop.100001&v=src=shop$shopid="+e.shopId+"$action=1&pin="+i+"&uid="+o+"&ver=1&rid="+Math.random()+"&m=UA-J2011-1&ref="+document.referrer)}})}function t(e){function i(){var e=n.find(".J-m-wrap"),i=n.attr("data-url");e.html("").jdQrcode({render:"image",ecLevel:"L",size:70,text:i})}function o(){var i=t.find("img");$.ajax({url:"//wq.jd.com/weidian/weixin/GetQRCode?venderid="+e.venderId,dataType:"jsonp",cache:!0,jsonpCallback:"getQRCode",success:function(e){e&&0==e.errcode&&""!=e.data.qrurl&&(i.attr("src",e.data.qrurl),t.show())}})}var t=$(".J-wd-qrcode"),n=$(".J-m-qrcode");o(),i()}function n(){$(".J-contact-text").show()}function a(a){var c=$(".J-hove-wrap");c.EDropdown(),r.addListener("onJimiReady",function(e){e.exists&&($(".J-jimi-item").show(),n())}),r.addListener("onIMReady",function(e){e.exists&&($(".J-im-item").show(),n())}),pageConfig.IMContact=new d({cfg:a,$el:$(".J-im-btn"),trigger:".im",template:'<div class="im"><i class="sprite-im"></i>{text}</div>'}),e(a,function(e,o){var t=o&&1===o.code;r.fire({type:"onJimiReady",exists:t}),i($(".J-jimi-btn").eq(0),"JIMI",a,o,t),i($(".J-jimi-btn").eq(1),"JIMI\u667a\u80fd\u673a\u5668\u4eba",a,o,t)}),o(a),t(a)}var r=require("MOD_ROOT/js/event").Event,d=require("MOD_ROOT/js/im"),c=require("MOD_ROOT/js/followshop");require("MOD_ROOT/js/EDropdown"),require("MOD_ROOT/js/jQuery.qrcode"),module.exports.__id="contact",module.exports.init=a});