/*!Name: onekey.js
 * Date: 2017-2-14 17:14:15 */
define("MOD_ROOT/js/onekey",function(require,exports,module){var e=require("MOD_ROOT/js/event").Event,i=require("JDF_UNIT/js/login");require("JDF_UI/js/dialog"),require("MOD_ROOT/js/ETooltips");var s={init:function(e){return this.$el=$("#btn-onkeybuy"),this.href=this.$el.attr("href"),this.ybParam="",this.giftParam="",this.did="",this.cfg=e,this.deps={isPriceMoreThan10:!1,havestock:!1,isLogin:!1,isNotYuShou:!e.isYuShou,isNotBiGouMa:!e.isBiGouMa,isNotHeYue:!e.isHeYue,isNotO2O:!(e.__chooseShop&&e.__chooseShop.selected)},this.$el.length&&this.bindEvent(e),this},isEnabled:function(e){this.deps.havestock=e.havestock,this.deps.isNotYuShou=!e.isYuShou,this.deps.isNotHeYue=!e.isHeYue,this.deps.isNotO2O=!(e.__chooseShop&&e.__chooseShop.selected);for(var i in this.deps)if(this.deps.hasOwnProperty(i)&&!this.deps[i])return!1;return!0},bindEvent:function(i){var s=this;if(this.$el.unbind("click").bind("click",function(){s.handleClick(i)}),e.addListener("onGiftSelected",function(e){s.isEnabled(i)&&(e.skus&&e.skus.length?s.giftParam=e.skus.join(","):s.giftParam="")}),e.addListener("onLDPSelected",function(e){s.isEnabled(i)&&(e.did?s.did=e.did:s.did="")}),e.addListener("onYBSelected",function(e){s.isEnabled(i)&&(e.skus&&e.skus.length?s.ybParam=e.skus.join(","):s.ybParam="")}),e.addListener("onPriceReady",function(e){s.deps.isPriceMoreThan10=Number(e.price.p)>10,s.isEnabled(i)&&s.show()}),e.addListener("onLogin",function(e){s.deps.isLogin=e.login,s.isEnabled(i)&&s.show()}),e.addListener("onStockReady",function(){s.isEnabled(i)?s.show():s.hide()}),e.addListener("onHeYueReady",function(e){var t=!i.isHeYue;t&&s.isEnabled(i)?s.show():s.hide()}),e.addListener("onYBSelected",function(e){return i.baiTiaoFenQi?void(!i.baiTiaoFenQi.hasSelectedItem&&s.isEnabled(i)&&s.show()):!1}),e.addListener("onBaiTiaoSelect",function(e){var t=e.isSelect;!t&&s.isEnabled(i)?s.show():s.hide()}),this.$el.length){if(i.isEBook)return;this.$el.ETooltips({close:!1,content:'<div id="easy-buy-tips"><div class="loading-style1"><b></b>\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...</div></div>',width:265,zIndex:10}).mouseover(function(){"true"!==$(this).data("loaded")&&(s.getCommonAddress(i),$(this).data("loaded","true"))})}},handleClick:function(e){function i(){s.checkLogin(function(i){i&&s.get(e)})}var s=this,t="undefined"!=typeof pageConfig.giftSelectedSkuids&&pageConfig.giftSelectedSkuids.length>0;if(pageConfig.haveGift){if(!t)return $("#choose-gift").addClass("item-hl-bg"),!1;i()}else i()},checkLogin:function(e){i({modal:!0,complete:function(i){e(i&&i.Identity&&i.Identity.IsAuthenticated)}})},get:function(e){var i=this,s=e.easyBuyUrl;$.ajax({url:s,data:{skuId:e.skuid,num:$("#buy-num").val(),gids:this.giftParam,ybIds:this.ybParam,did:this.did},dataType:"jsonp",jsonpCallback:"easybuysubmit",success:function(e){e&&i.set(e)}})},set:function(e){e.success&&e.jumpUrl&&(/debug=onekeybuy/.test(location.href)?alert(e.jumpUrl):window.location=e.jumpUrl),!e.success&&e.message&&$("body").dialog({title:"\u63d0\u793a",width:400,height:200,type:"text",source:e.message})},showBtn:function(){this.isEnabled(this.cfg)?this.show():this.hide()},show:function(){this.$el.show()},hide:function(){this.$el.hide()},getCommonAddress:function(e){var i=this;$.ajax({url:"//cd.jd.com/easybuy",data:{skuId:e.skuid},dataType:"jsonp",scriptCharset:"gbk",success:function(e){e?e.empty=!1:e={empty:!0},i.setCommonAddress(e)}})},setCommonAddress:function(e){var i='            <div class="easy-buy-tips" style="line-height:24px;">                {if !empty}                <p><strong>${name} </strong><span class="hl_gray">${mobile}</span></p>                <p class="hl_gray">${fullAddress}</p>                <p>                    {if pickName}                        <strong>${paymentId} \u4e0a\u95e8\u81ea\u63d0</strong>                        <span class="hl_gray">\uff08${pickName}\uff09</span>                    {else}                        <strong>${paymentId} \u5feb\u9012\u4e0a\u95e8</strong>                    {/if}                </p>                <p>                    <img src="//img10.360buyimg.com/da/jfs/t2317/61/1416600579/1235/edd6a9a9/565d08f7N7e6c5c46.png">                    \u4f7f\u7528\u4e00\u952e\u8d2d\uff0c\u5c06\u6309\u4e0a\u8ff0\u4fe1\u606f\u76f4\u63a5\u63d0\u4ea4\u8ba2\u5355</p>                {else}                <p><strong>\u4e00\u952e\u8d2d\uff0c\u5e2e\u60a8\u5feb\u901f\u4e00\u952e\u4e0b\u5355</strong></p>                <p class="hl_gray" style="line-height:1.5em;">\u521d\u6b21\u4f7f\u7528\u9700\u8bbe\u7f6e\u6536\u8d27\u5730\u5740\u548c\u652f\u4ed8\u3001\u914d\u9001\u65b9\u5f0f\uff0c\u7ee7\u7eed\u4f7f\u7528\u5373\u53ef\u5b8c\u6210\u4e00\u952e\u8d2d\u4e70\uff01</p>                {/if}            </div>';$("#easy-buy-tips").html(i.process(e))}};module.exports=s,module.exports.__id="oneKeyBuy"});