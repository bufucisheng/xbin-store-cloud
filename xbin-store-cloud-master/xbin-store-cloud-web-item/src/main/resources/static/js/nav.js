/*!Name: nav.js
 * Date: 2017-2-14 17:14:16 */
define("MOD_ROOT/js/nav",function(require,exports,module){var t=require("MOD_ROOT/js/core");require("PLG_ROOT/js/jQuery.scroller"),require("JDF_UNIT/js/trimPath");var e='    {for item in navItems}    <li data-id="detail-tag-id-${item.id}"         clstag="shangpin|keycount|product|maodian-${item.text}"         data-text="${item.text}" {if item_index==0} class="current"{/if}>        <a href="#none">            <i class="arrow-l">                <b class="layer1"></b>                <b class="layer2"></b>            </i>            <i class="arrow-r"></i>${item.text}        </a>    </li>    {/for}',a=function(t){this.$el=t.$el||$("<div></div>"),this.$wrap=t.$wrap||$("#detail"),this.template=t.template||e,this.onStart=t.onStart||function(){},this.onEnd=t.onEnd||function(){},this.targetSelector=t.targetSelector||'[name^="detail-tag-id-"]',this.items=this.$wrap.find(this.targetSelector),this.init()};a.prototype={init:function(){var t=$(".detail-content");this.items.length>0?(this.$el.show(),t.addClass("z-have-detail-nav"),this.setNavContent(),this.bindEvent()):t.removeClass("z-have-detail-nav")},onScroll:function(){function t(t){var e=$(window).height(),a=$("body").scrollTop()||$("html").scrollTop(),i=t.offset().top;return e+a>i&&i>a}var e=[];if(this.tags.each(function(a){var i=$(this);t(i)&&e.push(i)}),e.length>0){var a=e[0].attr("name").replace("detail-tag-id-","");this.listItems.removeClass("current"),this.listItems.filter('[data-id="detail-tag-id-'+a+'"]').addClass("current")}},bindEvent:function(){var e=this;$("body").scroller({onScroll:function(){e.onScroll()}}),this.$el.delegate("li","click",function(){var a=$(this).attr("data-id").replace("detail-tag-id-",""),i=$(this).attr("data-text"),n=e.$wrap.find("[name=detail-tag-id-"+a+"]").offset().top;$("#detail .tab-main").hasClass("pro-detail-hd-fixed")||(n-=39),$("body,html").animate({scrollTop:n-50});var s=pageConfig._CURR_AREA;log("skupage","cateid",a,t.cat[2],t.cat[1],t.cat[0],t.sku,s.provinceName,s.cityName,i)}),$.browser.isIE6()||this.$el.parent().scroller({delay:10,stopThreshold:$("#J-detail-nav").outerHeight(),onStart:function(){e.$el.addClass("fixed-top"),e.onStart(e)},onEnd:function(){e.$el.removeClass("fixed-top"),e.onEnd(e)}})},collectTags:function(){var t,e,a=this.items,i=a.length,n=0,s="\u5bfc\u822a",l={navItems:[]};if(this.tags=a,i>0)for(n;i>n;n++)t=a.eq(n).attr("name"),s=a.eq(n).attr("text"),t&&""!=t&&s&&(e=t.replace("detail-tag-id-",""),l.navItems.push({id:e,text:s}));return l},setNavContent:function(){var t=this.collectTags();this.$el.find("#J-detail-content-tab").html(this.template.process(t)),this.listItems=this.$el.find("li")}},module.exports=a});