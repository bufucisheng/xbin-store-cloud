/*!Name: followshop.js
 * Date: 2017-2-14 17:14:16 */
define("MOD_ROOT/js/followshop",function(require,exports,module){var t=require("JDF_UNIT/js/login");require("JDF_UNIT/js/trimPath");var o=function(t){this.vids=t.vids||[],this.$wrap=t.$wrap||$(".pop-score-summary"),this.$el=t.$el||$(".J-follow-shop"),this.checkStatus=!1,this.onFollow=t.onFollow||function(){},this.onunFollow=t.onunFollow||function(){},this.init()};o.prototype={init:function(){this.bindFollow(),this.setStatus()},setStatus:function(){function t(t){for(var l in t)t.hasOwnProperty(l)&&(a=o.$wrap.find('[data-vid="'+l+'"]'),a.attr("data-follow",!!t[l]),t[l]?(a.addClass("followed").attr("title","\u70b9\u51fb\u53d6\u6d88\u5173\u6ce8"),a.find("span").html("\u5df2\u5173\u6ce8\u5e97\u94fa")):(a.removeClass("followed").attr("title","\u70b9\u51fb\u5173\u6ce8"),a.find("span").html("\u5173\u6ce8\u5e97\u94fa")))}var o=this,a=null;this.checkStatus=!0,$.ajax({url:"//follow-soa.jd.com/rpc/vender/batchIsFollow",data:{venderIds:this.vids.join(","),sysName:"item.jd.com"},dataType:"jsonp",success:function(o){o&&"F10000"===o.code&&t(o.data)}})},bindFollow:function(){var o=this;this.$el.unbind().bind("click",function(){var a=$(this),l=a.attr("data-vid"),n="true"===a.attr("data-follow");t({modal:!0,complete:function(){o.checkStatus||o.setStatus(),n?o.unFollow(l,a):o.follow(l,a)}})})},follow:function(t,o){var a=this;return isNaN(parseInt(t))?(alert("\u4e0d\u5b58\u5728\u7684\u5546\u5bb6"),!1):void $.ajax({url:"//follow-soa.jd.com/rpc/vender/followByVid",dataType:"jsonp",data:{venderId:t,sysName:"item.jd.com"},success:function(t){return t?void(t.success&&"F10000"===t.code?(o.addClass("followed").attr("data-follow","true").attr("title","\u70b9\u51fb\u53d6\u6d88\u5173\u6ce8"),o.find("span").html("\u5df2\u5173\u6ce8\u5e97\u94fa"),a.onFollow.call(a)):"F0401"===t.code?alert("\u4e0d\u5b58\u5728\u7684\u5546\u5bb6"):"F0409"===t.code&&alert("\u5df2\u7ecf\u5173\u6ce8\u8fc7")):!1}})},unFollow:function(t,o){var a=this;$.ajax({url:"//follow-soa.jd.com/rpc/vender/unfollowByVid",dataType:"jsonp",data:{venderId:t,sysName:"item.jd.com"},success:function(t){t&&"F10000"===t.code&&(o.removeClass("followed").attr("data-follow","false").attr("title","\u70b9\u51fb\u5173\u6ce8"),o.find("span").html("\u5173\u6ce8\u5e97\u94fa"),a.onunFollow.call(a))}})}},module.exports=o});
