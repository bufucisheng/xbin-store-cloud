/*!Name: jdservice.js
 * Date: 2017-2-14 17:14:17 */
define("MOD_ROOT/js/jdservice",function(require,exports,module){function e(e){var a=$("#choose-service");if(a.length<1)return!1;var n=e.addToCartBtn;c.init({sku:e.skuid,cat:e.cat,brand:e.brand,onSelected:function(a,c,l){var d=i.$el.attr("href");t.fire({type:"onYBSelected",skus:a}),pageConfig.product.havestock&&(a.length>0?(n.enabled(s.getHrefWithYB(d,a)),pageConfig.hasYbService=!0,e.baiTiaoFenQi&&e.baiTiaoFenQi.disabled()):(n.enabled(s.getHrefWithYB(d,a)),pageConfig.hasYbService=!1,e.baiTiaoFenQi&&e.baiTiaoFenQi.enabled()))}},e)}var t=require("MOD_ROOT/js/event").Event,i=require("MOD_ROOT/js/buybtn").addToCartBtn,s=require("MOD_ROOT/js/core"),a=require("MOD_ROOT/js/tools"),n=(require("JDF_UNIT/js/trimPath"),'    <div class="dt" data-yb="new_yb_server">\u589e\u503c\u4fdd\u969c</div>    <div class="dd">        <div class="service-type-yb clearfix">            {for item in data}                <div class="yb-item-cat">                    <div class="yb-item">                        <img class="icon" src="${pageConfig.FN_GetImageDomain(item.details[0].bindSkuId)}${item.imgUrl}"/>                        <span class="name">${item.details[0].bindSkuName}</span>                        <span class="price">\uffe5${item.details[0].price}</span>                        <i class="arrow-icon"></i>                    </div>                    <div class="more-item">                        <ul>                            {for list in item.details}                            <li data-sku="${list.bindSkuId}">                                <div class="title" title="${list.tip}">                                     <span class="choose-btn" clstag="shangpin|keycount|product|jingdongfuwu_${list.bindSkuId}">                                        <i class="sprite-checkbox"></i>{if list.isFavor}<span class="tips">\u4f18\u60e0</span>{/if}<span class="name">${list.bindSkuName}</span><span class="price">\uffe5${list.price}</span>                                    </span>                                    <a href="//item.jd.com/${list.bindSkuId}.html" target="_blank" class="detail-more" clstag="shangpin|keycount|product|jingdongfuwu_xiangqing">\u8be6\u60c5<s class="s-arrow">&gt;&gt;</s></a>                                </div>                            </li>                            {/for}                        </ul>                    </div>                </div>            {/for}            <div class="service-tips">                <a href="#none"><i class="sprite-question"></i></a>                <div class="tips">                    <div class="sprite-arrow"></div>                    <div class="content">                    <dl>                        <dd>\u589e\u503c\u4fdd\u969c\u662f\u6307\u51e1\u5728\u4eac\u4e1c\u8d2d\u4e70\u5546\u54c1\u6216\u670d\u52a1\u7684\u6d88\u8d39\u8005\uff0c\u5728\u4fdd\u969c\u671f\u95f4\u5185\u9047\u5230\u65e0\u8bba\u662f\u6b63\u5e38\u4f7f\u7528\u4e2d\u7684\u95ee\u9898\u8fd8\u662f\u610f\u5916\u4e8b\u6545\uff0c\u5373\u53ef\u4eab\u53d7\u589e\u503c\u4fdd\u969c\u670d\u52a1\u3002\u4fdd\u969c\u5185\u5bb9\u5305\u62ec\uff1a\u5ef6\u957f\u4fdd\u4fee\u3001\u53ea\u6362\u4e0d\u4fee\u3001\u610f\u5916\u4fdd\u62a4\u3001\u670d\u52a1\u4fdd\u969c\u3002\u8986\u76d6\u5bb6\u7535\u3001\u624b\u673a\u6570\u7801\u3001\u7535\u8111\u529e\u516c\u3001\u6c7d\u8f66\u7528\u54c1\u3001\u670d\u9970\u5bb6\u5c45\u7b49\u5546\u54c1\u3002</dd>                    </dl>                    <p>\u5982\u6709\u7591\u95ee\uff0c\u8bf7\u4e0e<a href="//chat.jd.com/pop/chat?shopId=162403" target="_blank">\u5728\u7ebf\u5ba2\u670d</a>\u8054\u7cfb</p>                </div>            </div>        </div>    </div>'),c={init:function(e,t){this.sku=e.sku,this.cat=e.cat,this.brand=e.brand,this.$el=e.$el||$("#choose-service"),this.cfg=t,this.onSelected=e.onSelected||function(){},this.callback=e.callback||function(){},this.url="",this.currSku=null,this.bindEvent(),this.get()},bindEvent:function(){var e=this;this.$el.undelegate("click").delegate(".yb-item","click",function(){var t=$(this),i=t.parents(".yb-item-cat");i.hasClass("selected")?(i.find("li.selected .choose-btn").trigger("click"),e.updateFrist(i.find(".more-item li:eq(0)"),i.find(".yb-item"))):i.find(".more-item li:eq(0) .choose-btn").trigger("click")}),this.$el.delegate(".choose-btn","click",function(){var t=$(this),i=t.parents("li"),s=i.attr("data-sku"),a=t.parents(".yb-item-cat");return i.hasClass("selected")?(i.removeClass("selected"),a.removeClass("selected hover"),a.find(".yb-item").removeAttr("data-sku")):(a.find("li").removeClass("selected"),i.addClass("selected"),a.addClass("selected").removeClass("hover"),e.updateFrist(i,a.find(".yb-item"))),e.currSku=s,e.currEl=t,e.calResult(),!1}),this.$el.delegate(".yb-item-cat","mouseenter",function(){$(this).addClass("hover")}),this.$el.delegate(".yb-item-cat","mouseleave",function(){$(this).removeClass("hover")});var i=0;this.$el.delegate(".service-tips","mouseenter",function(){clearTimeout(i),$(this).addClass("hover")}),this.$el.delegate(".service-tips","mouseleave",function(){var e=$(this);i=setTimeout(function(){e.removeClass("hover")},300)}),t.addListener("onStockReady",function(){e.cfg.havestock?e.show():(e.hide(),e.clear())}),t.addListener("onHeYueReady",function(){var t=e.cfg.isHeYue;t?e.hide():e.cfg.havestock?e.show():(e.hide(),e.clear())})},updateFrist:function(e,t){var i=e.find(".name").html();t.find(".name").html(i),t.find(".name").attr("title",i),t.find(".price").html(e.find(".price").html()),t.attr("data-sku",e.attr("data-sku"))},get:function(){var e=this,t=e.sku,i=e.cat[0]+","+e.cat[1]+","+e.cat[2],s=e.brand,n=a.getAreaId().areaIds.join("_"),c="//cd.jd.com/yanbao/v3?skuId="+t+"&cat="+i+"&area="+n+"&brandId="+s;$.ajax({url:c,dataType:"jsonp",scriptCharset:"gbk",cache:!0,jsonpCallback:"yanbao_jsonp_callback",success:function(t){t&&e.set(t)}})},set:function(e){var t="",i=e[this.sku];if(i&&i.length>0){i.length>3&&(i.length=3);for(var s in i){var a=i[s];a.details&&a.details.length>6&&(a.details.length=6)}try{var c={data:i};t=n.process(c),this.$el.html(t),pageConfig.product.isHeYue||this.show()}catch(l){var d=t.match(/\[ERROR.+\]/);d&&d.length&&console.error("Template Render Error @ [jdService.js]. >>>>> \n   %s",d[0])}}else this.$el.html("");this.callback.call(this)},show:function(){this.cfg.havestock&&this.$el.show()},hide:function(){this.$el.hide()},clear:function(){this.$el.find(".yb-item").removeAttr("data-sku"),this.$el.find(".yb-item-cat").removeClass("selected"),this.$el.find(".yb-item-cat .more-item li").removeClass("selected")},calResult:function(){var e=this.$el.find(".selected"),t=[];return e.each(function(){var e=$(this).find(".yb-item"),i=e.attr("data-sku");i&&t.push(i)}),"function"==typeof this.onSelected?this.onSelected.apply(this,[t,this.currSku,this.currEl]):void 0}};module.exports.__id="jdservice",module.exports.init=e});