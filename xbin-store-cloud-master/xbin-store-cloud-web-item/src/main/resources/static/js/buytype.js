/*!Name: buytype.js
 * Date: 2017-2-14 17:14:15 */
define("MOD_ROOT/js/buytype",function(require,exports,module){function t(t){var e=(t.skuid,a.getAreaId().areaIds),i=e[0],s=e[1];return t.isFeeType?(window.CellPhone=r,void r.init(t,i,s,t.mainSkuId,function(t){})):!1}var e=require("MOD_ROOT/js/prom").Promotions,i=require("MOD_ROOT/js/stock"),s=require("MOD_ROOT/js/event").Event,a=(require("MOD_ROOT/js/buybtn"),require("MOD_ROOT/js/tools"));require("MOD_ROOT/js/core");require("MOD_ROOT/js/ETooltips"),require("JDF_UNIT/js/trimPath");var r={init:function(t,e,i,s,a,h){this.$el=$("#choose-type"),this.$hy=$("#choose-type-hy"),this.$suit=$("#choose-type-suit"),this.$btn=$("#btn-heyue"),this.$qiang=$("#btn-qiang"),this.$onkeybuy=$("#btn-onkeybuy"),this.$tipsTxt=this.$suit.find("#J-suit-tips"),this.$jjg=$("#prom-phone-jjg"),this.$promPhone=$("#prom-phone"),this.$promGift=$("#prom-gift"),this.$phoneAd=$("#p-ad-phone"),this.$amount=$("#choose-amount"),this.$disabled=$("#btype-tip"),this.$yysPlanTips=$(),this.$yysArrow=$(),this.$promiseIcon=$(".J-promise-icon"),this.sku=t.skuid,this.pid=e,this.cid=i,this.mainSkuId=s,this.sp="",this.cfg=t,this.onReady=a||function(){},this.onError=h||function(){},this.$currBuyType=null,this.$currHeYue=null,this.$currSuit=null,this.url="//feetype.jd.com/services/queryFeeTypes.action",/debug=yys/.test(location.href)&&(this.url="//yys.worker.jd.com/services/queryFeeTypes.action"),this.buyTypeIndex=null,this.disableClass="btn-disable",this.dtype=null,this.isHySuit=!1,this.noBuyType=!1,this.destory(),this.bindEvent(),this.getBuyType(this.sku,this.pid,this.cid,this.mainSkuId),pageConfig.matchFeetype=function(t){var e=r.getUrlFeeType(),i=!1,s=0;if(e&&t&&t.length)for(s=0;s<t.length;s++)if(t[s].ft==e){i=!0;break}return i}},bindEvent:function(){function t(){var t=a.getAreaId().areaIds;e.init(e.cfg,t[0],t[1])}var e=this;this.binded||(this.binded=!0,this.$el.undelegate("click").delegate(".item","click",function(){var t=$(this),i=t.hasClass("disabled"),s=t.hasClass("selected");i||s||(e.$currBuyType=t,e.handleBuyTypeClick(t))}),this.$hy.undelegate("click").delegate(".item","click",function(){var t=$(this),i=t.hasClass("disabled"),s=t.hasClass("selected");i||s||(e.$currHeYue=t,e.handleHyTypeClick(t))}),this.$suit.undelegate("click").delegate(".J-suit-trigger","click",function(){var t=$(this),i=t.attr("data-url")||e.$currHeYue.attr("data-aurl"),s=e.$currHeYue.attr("data-auth");e.$currSuit=t,e.showSuitIframe(i,s)}),this.$btn.unbind("click").bind("click",function(){return e.hasSuitIframe&&!e.suitSelected?(e.$suit.addClass("item-hl-bg"),e.$tipsTxt.show(),!1):void 0}),s.removeListener("onAreaChange",t),s.addListener("onAreaChange",t))},getTPL:function(t){var e='            <div class="dt">\u8d2d\u4e70\u65b9\u5f0f</div>            <div class="dd">                {for list in datas}                {var btype = list.feetypes[0]}                <div class="J-btype-item item{if list.che} selected{/if}"                     clstag="shangpin|keycount|product|gmfs-${list.name}"                     data-ind="${list_index}"                     data-matched="${pageConfig.matchFeetype(list.feetypes)}"                    {if !(list.sp===-1&&btype.ft===100)}                    data-ishy="true"                     {/if}                    data-sp="${list.sp}"                     data-count="${list.feetypes.length}"                    clstag="shangpin|keycount|product|goumaifangshi_${list.name}">                    <b></b>                    <a href="#none" title="">${list.name}</a>                </div>                {/for}            </div>',i='            <div class="dt">\u4f18\u60e0\u7c7b\u578b</div>            <div class="dd">                {for item in datas}                <div class="J-hy-btype {if !item.che} hide{/if}">                    {for list in item.feetypes}                    <div class="item{if list.che||(item.sp===-1&&list.ft===100)} selected{/if}{if !list.stat} disabled{/if}"                         clstag="shangpin|keycount|product|hylx-${list.name}"                         data-aurl="${list.aurl}"                        data-rurl="${list.rurl}"                        data-type="${list.type}"                        data-dtype="${list.dtype}"                        data-id="${list.ft}"                         data-skus="${list.sids}"                         data-ad="${list.ad}"                         data-ind="${list_index}"                         data-sku="${list.sku}"                        data-sp="${item.sp}">                        <b></b>                        <a href="#none" title="${list.tips}">${list.name}</a>                    </div>                    {/for}                </div>                {/for}                {if list.ft!==100}                    <a class="J-hy-btype-tips hy-btype-tips icon question fl"                         href="#none"><i class="sprite-question"></i></a>                {/if}            </div>',s='            <div class="J-prom-phone-jjg">                <em class="hl_red_bg">${title||"\u52a0\u4ef7\u8d2d"}</em>                <em class="hl_red">${text}</em>                <a title="\u53c2\u52a0\u6d3b\u52a8\u5165\u53e3" clstag="eve|keycount|treaty|JJGDetails" class="J-jjg-btn" href="#none">                    &nbsp;&nbsp;\u70b9\u51fb\u62a2\u8d2d <s class="s-arrow">&gt;</s>                </a>            </div>',a='            <div id="shf-feetype">                  <dl class="dl-1">                      <dt class="fl">\u60a8\u9700\u6d88\u8d39\uff1a</dt>                      <dd class="lh hl_red">${info.cons}</dd>                  </dl>                  <dl class="dl-2">                      <dt class="fl">\u60a8\u5c06\u5f97\u5230\uff1a</dt>                      <dd class="lh">                          <ul class="hl_red">                              <li>\u624b\u673a <em>&times; 1</em></li>                              <li>${stockArea}\uff08\u624b\u673a\u5361\uff09 <em>&times; 1</em></li>                              <li>\u8d60\u9001\u8bdd\u8d39 ${info.pres}</li>                          </ul><div class="clr"></div>                          <p>${info.pack} </p>                          <table>                              <tr>                                  <td><div><strong>\u8bed\u97f3\u901a\u8bdd(\u5206\u949f)</strong></div>{if info.cal!=="null"}${info.cal}{/if}</td>                                  <td><div><strong>\u56fd\u5185\u77ed\u4fe1(\u6761)</strong></div>{if info.msg!=="null"}${info.msg}{/if}</td>                              </tr>                              <tr>                                  <td><div><strong>\u56fd\u5185\u6d41\u91cf</strong></div>{if info.traf!=="null"}${info.traf}{/if}</td>                                  <td><div><strong>\u63a5\u542c\u514d\u8d39</strong></div>{if info.area!=="null"}${info.area}{/if}</td>                              </tr>                          </table>                          <div class="shf-buy-now">                              <a class="btn-primary J-btn" href="${resLink}" target="_blank" clstag="eve|keycount|treaty|JJGRedirect" class="css3-btn">\u9009\u62e9\u53f7\u7801</a>                          </div>                      </dd>                  </dl><span clstag="eve|keycount|treaty|JJGDetails" id="JJGDetails">\u3000</span>            </div>';return"btype"===t?e:"suit"===t?i:"jjg-prom"===t?s:"jjg-iframe"===t?a:void 0},handleBuyTypeClick:function(t){var e=t.attr("data-ind"),i=(t.attr("data-sp"),"true"===t.attr("data-ishy"));this.switchTo(t),this.buyTypeIndex=e,this.isHeYue=i,pageConfig.product.isHeYue=i,this.$currHeYue=this.$hy.find(".J-hy-btype").eq(this.buyTypeIndex).find(".selected"),this.switchBtn(i),this.setResult(this.getParams(this.$currHeYue))},switchBtn:function(t){var e=this;t?this.onHeYue():this.onNonHeYue();var a={extraParam:'{"originid":"1"}'};this.isHeYue&&(a.extraParam='{"originid":"1","heYueJi":"1"}'),new i(a,function(t){e.setBuyBtn()}),s.fire({type:"onHeYueReady",bType:this.bType,noBuyType:this.noBuyType})},handleHyTypeClick:function(t){var e=t.attr("data-ind"),i=t.parent().find(".item"),s=i.removeClass("selected").eq(e);s.addClass("selected"),this.$currHeYue=s,this.setResult(this.getParams(this.$currHeYue))},switchTo:function(t){var e=t.attr("data-ind"),i=t.parent().find(".J-btype-item"),s=this.$hy.find(".J-hy-btype");i.removeClass("selected").eq(e).addClass("selected"),s.hide().eq(e).show()},getBuyType:function(t,e,i,s){var a=this;window.fetch_feetype_data=function(){},$.ajax({url:this.url,dataType:"jsonp",scriptCharset:"utf-8",timeout:5e3,cache:!0,jsonpCallback:"fetch_feetype_data",data:{skuId:t,cityId:i,provinceId:e,productId:s},error:function(t){a.onReady.call(this,100),a.onError.call(this,100)},success:function(t){a.handleBuyTypeData(t)}})},handleBuyTypeData:function(t){var i=pageConfig.chooseType=!!t&&t.datas.length>0,s=i?"show":"hide",a=i&&t.promo;this.$amount[s](),i?(this.r=t,this.setBuyType(t),a&&this.setJiaJiaGou(t.promo)):(e.init(pageConfig.product.skuid),this.$el.html("<!--oops, \u6728\u6709\u6570\u636e\u4e86^!^-->"),this.disabled(),this.onReady.call(this,"100"))},setBuyType:function(t){var e=this.getTPL("btype"),i=e.process(t),s=i.match(/\[ERROR:.+\]/g);return t&&t.sp&&(this.sp=t.sp),s&&s[0]?($("#summary-promotion").hide(),console.error("[BuyType]Template Rendering error.\n"),console.error(s[0]),this.onError.call(this,100,s)):(t.dis?this.$disabled.show():this.$disabled.hide(),this.$el.html(i),this.noBuyType=1==t.datas.length&&1==t.datas[0].feetypes.length&&"-1"===t.datas[0].feetypes[0].name,this.noBuyType?this.$el.hide():this.$el.show(),void this.setHyType(t))},setHyType:function(t){var e=this.getTPL("suit"),i=e.process(t),s=i.match(/\[ERROR:.+\]/g);s&&s[0]&&($("#summary-promotion").hide(),console.error("[BuyType]Template Rendering error.\n"),console.error(s[0])),this.$hy.html(i),this.noBuyType?this.$hy.hide():this.$hy.show();var a=this.getUrlFeeType();if(a){var r=this.$el.find('[data-matched="true"]');this.switchTo(r)}this.$currBuyType=this.$el.find(".selected"),this.buyTypeIndex=this.$currBuyType.attr("data-ind"),this.$currBuyTypes=this.$hy.find(".J-hy-btype").eq(this.buyTypeIndex).find(".item");var h=this.$currBuyTypes.filter('[data-id="'+a+'"]');a&&h?(this.$currHeYue=h,this.$currBuyTypes.removeClass("selected"),this.$currHeYue.addClass("selected")):this.$currHeYue=this.$currBuyTypes.filter(".selected"),this.bType=this.$currHeYue.attr("data-id"),this.isHeYue="true"===this.$currBuyType.attr("data-ishy"),pageConfig.product.isHeYue=this.isHeYue,this.$currHeYue.length||(this.disabledBuy=!0),this.switchBtn(this.isHeYue);var n=this.getParams(this.$currHeYue);this.setResult(n)},getTips:function(){var t="\u79fb\u52a8\u8001\u7528\u6237\uff0c\u65e0\u9700\u6362\u53f7\uff0c\u53ea\u9700\u627f\u8bfa\u4e1a\u52a1\u5185\u5bb9\uff0c\u5373\u53ef\u6bcf\u6708\u83b7\u5f97\u9ad8\u989d\u7684\u8bdd\u8d39\u8fd4\u8fd8",e="\u540c\u65f6\u8d2d\u4e70\u624b\u673a\u548c\u65b0\u53f7\u7801\uff0c\u5373\u53ef\u6839\u636e\u6240\u9009\u7684\u5957\u9910\u6863\u4f4d\uff0c\u6309\u6708\u83b7\u5f97\u4e00\u5b9a\u989d\u5ea6\u7684\u8bdd\u8d39\u8d60\u9001",i={name:"\u8054\u901a/\u7535\u4fe1",8:"\u540c\u65f6\u8d2d\u4e70\u624b\u673a\u548c\u65b0\u53f7\u7801\uff0c\u5e76\u9884\u5b58\u4e00\u5b9a\u91d1\u989d\u7684\u8bdd\u8d39\uff08\u540e\u7eed\u5c06\u5206\u6708\u8fd4\u8fd8\uff09\uff0c\u5373\u53ef\u62b5\u6263\u7b49\u503c\u7684\u8d2d\u673a\u6b3e\uff0c\u8d2d\u673a\u6b3e\u6700\u9ad8\u53ef\u51cf\u81f30\u5143",28:"\u540c\u65f6\u8d2d\u4e70\u624b\u673a\u548c\u65b0\u53f7\u7801\uff0c\u5373\u53ef\u6839\u636e\u6240\u9009\u7684\u5957\u9910\u6863\u4f4d\uff0c\u6309\u6708\u83b7\u5f97\u4e00\u5b9a\u989d\u5ea6\u7684\u8bdd\u8d39\u8d60\u9001",27:"\u8d2d\u4e70\u65b0\u624b\u673a\u65f6\u529e\u7406\u4e00\u5f20\u65b0\u7535\u8bdd\u5361\uff0c\u53ef\u4ee5\u81ea\u7531\u9009\u62e9\u5957\u9910\u4e2d\u8bed\u97f3\u3001\u6d41\u91cf\u3001\u77ed\u4fe1\u7684\u642d\u914d\u548c\u7528\u91cf",33:"\u7535\u4fe1\u8001\u7528\u6237\uff0c\u4e0d\u6362\u53f7\uff0c\u4e70\u624b\u673a\uff0c\u529e\u7406\u65b0\u5957\u9910\uff0c\u5373\u53ef\u6309\u7167\u4f18\u60e0\u89c4\u5219\u6309\u6708\u83b7\u5f97\u989d\u5916\u7684\u8bdd\u8d39\u8d60\u9001",2:e,5:e,12:e},s={"-1":"",1:{name:"\u79fb\u52a8",5:t,12:t,18:"\u5168\u56fd\u79fb\u52a8\u8001\u7528\u6237\u5747\u53ef\u529e\u7406\uff0c\u627f\u8bfa\u5728\u7f51\u65f6\u957f\u548c\u5957\u9910\u5185\u5bb9\uff0c\u5373\u53ef\u6bcf\u6708\u83b7\u8d60\u4e00\u5b9a\u989d\u5ea6\u7684\u8bdd\u8d39\uff08\u79fb\u52a8\u8d2d\u673a\u4e13\u4eab\u65e0\u8bdd\u8d39\u8fd4\u8fd8\uff09",32:"\u4e0a\u6d77\u79fb\u52a8\u8001\u7528\u6237\uff0c\u627f\u8bfa\u6708\u6700\u4f4e\u6d88\u8d39\uff0c\u5373\u53ef\u6bcf\u6708\u4eab\u53d7\u4e00\u5b9a\u989d\u5ea6\u7684\u8bdd\u8d39\u8d60\u9001",34:"\u5317\u4eac\u79fb\u52a8\u8001\u7528\u6237\uff0c\u4e0d\u6362\u53f7\uff0c\u4e70\u624b\u673a\uff0c\u5373\u53ef\u6bcf\u6708\u4eab\u53d7\u4e00\u5b9a\u989d\u5ea6\u7684\u8bdd\u8d39\u8d60\u9001",35:"\u5c71\u897f\u79fb\u52a8\u8001\u7528\u6237\uff0c\u4e0d\u6362\u53f7\uff0c\u4e70\u624b\u673a\uff0c\u5373\u53ef\u6bcf\u6708\u4eab\u53d7\u4e00\u5b9a\u989d\u5ea6\u7684\u8bdd\u8d39\u8d60\u9001",36:"\u798f\u5efa\u79fb\u52a8\u8001\u7528\u6237\uff0c\u4e0d\u6362\u53f7\uff0c\u529e\u5408\u7ea6\uff0c\u5373\u53ef\u6bcf\u6708\u4eab\u53d7\u4e00\u5b9a\u989d\u5ea6\u7684\u8bdd\u8d39\u8d60\u9001"},2:i,3:i};return s},setTips:function(t){var e=this.$hy.find(".J-hy-btype-tips"),i=t.attr("data-sp")||-1,s=t.attr("data-id")||-1,a=this.getTips()[i][s];a?e.show().ETooltips({close:!1,content:a,width:200,position:"bottom",zIndex:10}):e.hide()},getParams:function(t){return t&&t.length?{sku:t.attr("data-sku"),skus:t.attr("data-skus"),id:t.attr("data-id"),ad:t.attr("data-ad"),ind:t.attr("data-ind"),type:t.attr("data-type"),dtype:t.attr("data-dtype")}:null},setSuitContent:function(t){this.suitSelected=!0,t&&(this.disabledBuy=!1,this.$suit.find(".J-suit-trigger").attr("data-url",this.formatBtypeUrl(t.aurl,t.auth)).addClass("selected").find("a").html(t.message),this.$suit.find(".J-suit-resel").show(),this.$suit.removeClass("item-hl-bg").find(".J-suit-tips").hide(),this.setBuyBtn(this.formatBtypeUrl(t.rurl,t.auth)))},getSuitName:function(t){var e={0:"\u9009\u62e9\u5957\u9910\u4e0e\u53f7\u7801",1:"\u9009\u62e9\u5957\u9910\u4e0e\u8d44\u8d39"};return e[t]},setSuitName:function(t){this.$suit.find(".J-suit-trigger a").html(this.getSuitName(t))},clearSuit:function(){var t=this.getSuitName(this.dtype);this.suitSelected=!1,this.$suit.find(".J-suit-resel").hide(),this.$suit.find(".J-suit-trigger").removeClass("selected").removeAttr("data-url").find("a").html(t).attr("title",t)},setResult:function(t){var i=t&&t.id;if(this.hasSuitIframe=!!this.$currHeYue.attr("data-aurl"),this.bType=i,this.dtype=t.dtype,this.isOnlyNonHeYue=1===this.$currBuyTypes.length&&"100"===this.bType,this.setTips(this.$currHeYue),this.hasSuitIframe?(this.clearSuit(),this.setSuitName(t.dtype),this.$suit.show()):this.$suit.hide(),this.isOnlyNonHeYue?this.$hy.hide():this.noBuyType||this.$hy.show(),"function"==typeof this.onReady&&this.onReady.call(this,i),this.disabledBuy=!t,this.disabledBuy)return this.setBuyBtn();if(t.sku&&this.sku!==Number(t.sku)&&(location.href="//"+location.host+"/"+t.sku+".html"),this.hasSuitIframe&&this.suitSelected)return this.setBuyBtn();if(t.ad){this.$phoneAd.html(t.ad).show();var s=t.ad.replace(/<.*?>/g,"");this.$phoneAd.attr("title",s)}else this.$phoneAd.html("").hide(),this.$phoneAd.attr("title","");t.skus?(e.clear(),this.getPhoneProm(t.skus)):(this.clearPhoneProm(),t.skus!==this.isHySuit&&e.init(this.sku)),this.isHySuit=!!t.skus,this.setBuyBtn()},onHeYue:function(){this.cfg.addToCartBtn.hide(),this.$btn.show(),this.cfg.isKO&&this.cfg.koBtn.hide(),this.$promiseIcon.hide(),this.$qiang.hide(),this.cfg.notifyBtn.show(),this.$yysPlanTips.hide(),this.$yysArrow.hide()},onNonHeYue:function(){this.cfg.addToCartBtn.show(),this.$btn.hide(),this.cfg.isKO&&this.cfg.koBtn.show(),this.cfg.notifyBtn.show(this.cfg),this.$promiseIcon.show(),this.$yysPlanTips.show(),this.$yysArrow.show()},formatBtypeUrl:function(t,e){var i=t.replace(/{sku}/g,this.sku).replace(/{btype}/g,this.bType).replace(/{pid}/g,this.pid).replace(/{cid}/g,this.cid).replace(/{productId}/g,this.mainSkuId).replace(/{sp}/g,this.sp).replace(/{venderId}/g,pageConfig.product.venderId);return e&&(i=i.replace(/{auth}/g,e)),i},showSuitIframe:function(t){var e=this.formatBtypeUrl(t),i=this.getSuitName(this.dtype);seajs.use("JDF_UI/js/dialog",function(){$("body").dialog({type:"iframe",autoIframe:!1,width:710,height:600,title:i,source:e})})},setBuyBtnText:function(t){if(!this.$currHeYue)return!1;var t=this.$currHeYue.attr("data-type"),e="\u4e0d\u6362\u53f7\u529e\u5957\u9910";"0"===t&&(e="\u9009\u62e9\u53f7\u7801\u548c\u5957\u9910"),"2"===t&&(e="\u7acb\u5373\u8d2d\u4e70"),this.$btn.html(e).attr("clstag","shangpin|keycount|product|"+e+"_"+pageConfig.product.pType)},disabled:function(){this.$btn.addClass(this.disableClass).attr("href","#none")},enabled:function(t){var e=this.cfg;return e.isClosePCShow||!e.havestock?!1:(this.$btn.removeClass(this.disableClass),void(t&&this.$btn.attr("href",t)))},setBuyBtn:function(t){var e="//eve.jd.com/redirect.action?";if((pageConfig.product.havestock===!1||pageConfig.product.isClosePCShow)&&(this.disabledBuy=!0),this.setBuyBtnText(),this.disabledBuy)this.disabled();else{var i=t||e+$.param({wid:this.sku,btype:this.bType,pid:this.pid,cid:this.cid,r:Math.random()});this.enabled(i)}},getUrlFeeType:function(){var t=location.href.toLowerCase(),e=null,i=null;return t.indexOf("feetype")>-1&&(e=t.match(/feetype=\w+/g),null!==e&&(i=e[0].replace("feetype=",""))),i},getPhoneProm:function(t){var e=this,i="//jprice.jd.com/contractsuit/{sku}_{skus}_{pid},0,0_1_1_CellPhone.setPhoneProm_html",s=i.replace("{sku}",this.sku).replace("{skus}",t).replace("{pid}",this.pid);$.ajax({url:s,dataType:"jsonp",success:function(t){e.setPhoneProm(t)}})},setPhoneProm:function(t){var e=[],i=[],s='        <div class="prom-gifts clearfix">            <span class="prom-gift-label"><em>\u8d60\u54c1</em></span>            <div class="prom-gift-list">                {for item in gs}                {if item.t==2}                <div class="prom-gift-item">                    <a target="_blank" href="//item.jd.com/${item.id}.html" title="${item.name}">                        {if item.img}                        <img src="${pageConfig.FN_GetImageDomain(item.id)}n5/${item.img}" width="25" height="25" class="gift-img">                        {else}                        <img src="//misc.360buyimg.com/product/skin/2012/i/gift.png" width="25" height="25" class="gift-img">                        {/if}                    </a>                    <em class="gift-number">\xd7 ${item.num}</em>                </div>                {/if}                {/for}            </div>        </div>';if(t.csl&&t.csl.length>0)for(var a=0;a<t.csl.length;a++)if(t.csl[a].skuId===t.sid){$("#summary-price strong").html("\uffe5"+t.csl[a].p.toFixed(2));break}if(t.d&&e.push('<em class="hl_red_bg">\u76f4\u964d</em><em class="hl_red">\u5df2\u4f18\u60e0\uffe5'+t.d+"\u5143</em>"),t.s&&e.push('<em class="hl_red_bg">\u8d60\u4eac\u8c46</em><em class="hl_red">\u8d60'+t.s+"\u4eac\u8c46</em>"),t.gs&&t.gs.length>0&&i.push(s.process(t)),t.cl&&t.cl.length>0){var r="",h="",h="",n="";r+='<em class="hl_red_bg">\u8d60\u5238</em>';for(var d=0;d<t.cl.length;d++)t.cl[d].k&&(h="\u9650\u54c1\u7c7b"),1===t.cl[d].t&&(n="\u4eac"),2===t.cl[d].t&&(n="\u4e1c"),perfix+=t.cl[d].q+"\u5143"+n+h+"\u5238 ";r+='<em class="hl_red">\u8d60\u9001'+perfix+"</em>",e.push(r)}e.length?this.$promPhone.html('<div class="J-prom-phone">'+e.join("<br/>")+"</div>"):this.$promPhone.html(""),i.length?this.$promGift.html('<div class="J-prom-phone-gift">'+i.join("<br/>")+"</div>"):this.$promGift.html(""),this.originPromCount=($("#prom-bvalue").length>0?1:0)+($("#prom-quan em").length>0?1:0)},setJiaJiaGou:function(t){var i="//eve.jd.com/redirect.action?"+$.param({wid:this.sku,btype:t.info.ft,pid:this.pid,cid:this.cid,r:Math.random()}),s=$("#store-selector .text div").text();s.indexOf("\u5e02")>0?t.stockArea=s.substr(0,s.indexOf("\u5e02")+1):t.stockArea=s.substr(0,2),t.resLink=i;var a=this.getTPL("jjg-prom"),r=this.getTPL("jjg-iframe");this.$jjg.html(a.process(t)),this.$jjg.find(".J-jjg-btn").unbind("click").bind("click",function(){seajs.use("JDF_UI/js/dialog",function(){$("body").dialog({width:550,height:320,title:"\u52a0\u4ef7\u8d2d",source:r.process(t),onReady:function(){var t=$("#shf-feetype a");pageConfig.product.havestock?t.attr("clstag","eve|keycount|treaty|JJGRedirect"):t.removeClass("css3-btn").addClass("css3-btn-gray").attr("href","#none").removeAttr("target").after("<strong>\u3000\u6240\u9009\u5730\u533a\u8be5\u5546\u54c1\u6682\u65f6\u65e0\u8d27\uff0c\u975e\u5e38\u62b1\u6b49\uff01</strong>").removeAttr("clstag")}})})}),e.init(!1,!0),e.$el.show(),e.promCount++,e.setFoldLayer()},setPlanIframe:function(t){var e=this,i="z-have-phone-service";this.$yysPlanTips=this.$el.find("#yys-plan-tips"),this.$yysArrow=$("#J-yys-arrow"),"100"===t?(e.$yysPlanTips.show(),e.$yysArrow.show(),e.$el.addClass(i)):(e.$yysPlanTips.hide(),e.$yysArrow.hide(),e.$el.removeClass(i)),e.$yysPlanTips.undelegate().delegate(".J-popup-iframe","click",function(){var t="//dj.eve.jd.com/queryCtcPackageInfo.action?",i=$(this).attr("data-url"),s=$.param({skuId:e.sku,provinceId:e.pid,cityId:e.cid,r:Math.random()}),a="";a=i?i.indexOf("?")>-1?i+s:i+"?"+s:t+s,seajs.use("JDF_UI/js/dialog",function(){pageConfig.bTypeIframe=$("body").dialog({type:"iframe",width:690,height:610,title:"\u5957\u9910\u53d8\u66f4",autoIframe:!1,iframeTimestamp:!1,source:a,onReady:function(){var t=$(this.el).width();$(this.el).addClass("popup-phone-service"),$(this.content).width(t)}})})})},clearPhoneProm:function(){this.$promPhone.html(""),this.$promGift.html("")},destory:function(){this.$el.html("").hide(),this.$hy.html("").hide(),this.$phoneAd.html("").hide(),this.$jjg.html(""),this.$suit.hide().removeClass("item-hl-bg")}};module.exports.__id="buytype",module.exports.init=t,module.exports.CellPhone=r});