/*!Name: o2o.js
 * Date: 2017-2-14 17:14:17 */
define("MOD_ROOT/js/o2o",function(require,exports,module){function t(t){var i=$("#choose-shop");t.__chooseShop=s.init(i,t)}var i=require("MOD_ROOT/js/event").Event,e=require("MOD_ROOT/js/tools"),s=(require("MOD_ROOT/js/buybtn"),{init:function(t,i){return this.$el=t,this.$btn=$("#choose-btn-shop"),this.$baitiao=$("#choose-baitiao"),this.cfg=i,this.selected=!1,this.$el.length&&this.$btn.length?(this.get(),this.bindEvent(),this):!1},bindEvent:function(){this.$el.undelegate("click"),this.$el.delegate(".item,.J-mod","click",$.proxy(this.openIframe,this)),this.$el.delegate(".J-cancel","click",$.proxy(this.reset,this)),i.addListener("onNumChange",$.proxy(this.setBtnLink,this)),i.addListener("onAreaChange",$.proxy(this.handleAreaChange,this))},handleAreaChange:function(){this.cfg.havestock&&this.selected?this.enableBtn():this.disableBtn()},openIframe:function(){var t="//cd.jd.com/locshop?",i=e.getAreaId().areaIds,s={skuId:this.cfg.skuid,cat:this.cfg.cat.join(","),addrCodeLv1:i[0],addrCodeLv2:i[1],addrCodeLv3:i[2],venderId:this.cfg.venderId,modifyFlag:!!this.selected,sku:this.sku||"",sid:this.sid||"",num:this.num||"",name:this.name||"",price:this.price||"",provider:this.provider||"",coor:this.coor||""};$("body").dialog({width:900,height:520,title:"\u9009\u62e9\u95e8\u5e97",type:"iframe",autoIframe:!1,source:t+$.param(s),onReady:function(){$("#dialogIframe").css("height","100%")}})},setResult:function(t,i,e,s,n,h,o){t=t||"",i=i||"",s=s||"",n=n||1,e=e||"",h=h||"",this.selected=!0,this.sku=t,this.sid=i,this.num=n,this.name=e,this.price=s,this.provider=h,this.coor=o,e.length>25&&(e=e.substr(0,25)+"...");var a="{0} \uffe5{1}&times;{2}".format(e,s,n);h="\u7531 {0} \u63d0\u4f9b\u670d\u52a1".format(h),this.$el.find(".item").addClass("selected"),this.setContent(a,h),this.setBtn(),this.setBtnLink(),this.showResult()},setContent:function(t,i){this.$el.find(".J-service-provider").html(i),this.$el.find(".item a").html(t)},setBtnLink:function(){var t="//cart.jd.com/cart/dynamic/gateForSubFlow.action?",i=$.param({wids:this.cfg.skuid+","+this.sku,nums:$("#buy-num").val()+","+this.num,sid:this.sid,subType:47,r:Math.random()});this.buyUrl=t+i,this.$btn.hasClass("btn-disable")||this.$btn.attr("href",this.buyUrl)},showBtn:function(){this.$btn.show()},hideBtn:function(){this.$btn.hide()},enableBtn:function(){this.$btn.removeClass("btn-disable"),this.buyUrl&&this.$btn.attr("href",this.buyUrl)},disableBtn:function(){this.$btn.addClass("btn-disable"),this.$btn.attr("href","#none")},setBtn:function(){this.showBtn(),this.cfg.havestock?this.enableBtn():this.disableBtn(),this.cfg.baiTiaoFenQi.showItem(),this.cfg.baiTiaoFenQi.hideBtn(),this.cfg.addToCartBtn.hide(),this.cfg.oneKeyBuyBtn.hide()},get:function(){$.ajax({url:"//c.3.cn/locshop/has",data:{skuId:this.cfg.skuid,cat:this.cfg.cat.join(",")},dataType:"jsonp",timeout:1e3,error:$.proxy(this.set,this),success:$.proxy(this.set,this)})},set:function(t){return t&&"true"===t.hasLocShop?(this.render(),void this.$el.show()):(this.$el.hide(),this.clear(),!1)},render:function(){var t='                <div class="item"><b></b><a href="#none">\u9009\u62e9\u95e8\u5e97\u53ca\u670d\u52a1</a></div>                <div class="J-operate operate fl hide">                    <a href="#none" class="J-mod">\u4fee\u6539</a>                    <a href="#none" class="J-cancel">\u53d6\u6d88</a>                </div>                <div class="J-service-provider service-provider hide"></div>';this.$el.find(".dd").html(t)},showResult:function(){this.$el.find(".J-operate,.J-service-provider").show()},hideResult:function(){this.$el.find(".J-operate,.J-service-provider").hide()},reset:function(){this.selected=!1,this.$el.find(".item").removeClass("selected"),this.render(),this.hideResult(),this.hideBtn(),this.$baitiao.show(),this.cfg.addToCartBtn.show(),this.cfg.oneKeyBuyBtn.showBtn(),this.cfg.baiTiaoFenQi.showItem()},clear:function(){this.$el.find(".dd").html("")}});module.exports.__id="o2o",module.exports.init=t});