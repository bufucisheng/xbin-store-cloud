/*!Name: fittings.js
 * Date: 2017-2-14 17:14:16 */
define("MOD_ROOT/js/fittings",function(require,exports,module){function t(t,i,e){$.ajax({url:t,dataType:"jsonp",data:i,scriptCharset:"gbk",jsonpCallback:"handleComboCallback",success:function(t){if(!t)return!1;for(var i in t)t.hasOwnProperty(i)&&200===t[i].status&&t[i].data&&e({method:i,data:t[i].data})}})}function i(i){var e=o.getUUID(),a=o.getAreaId().areaIds[0],s=null,n=i.pType;1===n&&(s=103003),2===n&&(s=102001),3===n&&(s=104001),4===n&&(s=104026);var d={methods:"accessories",p:s,sku:i.skuid,cat:i.cat.join(","),lid:a,uuid:e,pin:readCookie("pin")||"",ck:"pin,ipLocation,atw,aview",lim:i.wideVersion?6:5,cuuid:readCookie("__jdu"),csid:readCookie("__jdb")};t("//c.3.cn/recommend",d,function(t){if(t.method&&t.data){if("accessories"==t.method)return void h.init(i).set(t.data);require.async(["MOD_ROOT/"+t.method+"/"+t.method,"MOD_ROOT/"+t.method+"/"+t.method+".css"],function(e,a){e?e(i,t.data,d):console.error("Method: "+e+" not found. Maybe combo serve error.")})}})}function e(){var t=$("#shopRecSuit");t.length&&t.ETab()}function a(){var t=$("#shopRecSuit"),i=$("#shop-reco");if(!i.length)return!1;i.ELazyload({source:"data-lazyload"});var e=[];i.find("[data-sku]").each(function(){e.push($(this).data("sku"))}),o.priceNum({skus:e,$el:i}),t.removeClass("hide"),$(".J-shopRec-trigger").removeClass("hide"),$(".J-shopRec-content").removeClass("hide")}function s(t){e(),a(),i(t)}var n=require("MOD_ROOT/js/event").Event,o=require("MOD_ROOT/js/tools"),d=require("MOD_ROOT/js/core");require("MOD_ROOT/js/ETab");var c='    {for item in data}    <li data-push="${pageConfig[skuHooks].push(item.wid)}" class="p-list" onclick=\'log("gz_item", "gz_detail","02","tjpj_sp_${item_index}","","main")\'>        <div class="p-img">            <a href="//item.jd.com/${item.wid}.html" target="_blank">                <img width="100" height="100" src="${pageConfig.FN_GetImageDomain(item.wid)}n4/${item.imageUrl}">            </a>        </div>        <div class="p-name">            <a href="//item.jd.com/${item.wid}.html" target="_blank">${item.wName}</a>        </div>        <div class="p-price">            <input type="checkbox" data-sku="${item.wid}" id="inp-acc-${item.wid}" onclick=\'log("gz_item", "gz_detail","02","tjpj_fxk_${item_index}","","main")\'/>            <label for="inp-acc-${item.wid}"><strong class="J-p-${item.wid}">\uffe5.00</strong></label>        </div>    </li>    {/for}';pageConfig.getAccSelectedSkus=function(){return pageConfig.accSelectedSkus.join("-")||d.sku};var h={init:function(t){return this.$el=$("#fittings"),this.$more=this.$el.find(".J-more"),this.$count=this.$el.find(".J-selected-cnt"),this.$btn=this.$el.find(".J-btn"),this.$cmbPrice=this.$el.find(".J_cal_jp"),this.sku=t.skuid,this.cat=t.cat,this.cfg=t,this.skuHooks="SKUS_Fitting",this.$el.length&&this.bindEvent(t),this},switchTo:function(t){var i=this.$tab.items.eq(t),e=this.data[t-1];i.data("loaded")||0===t||(pageConfig[this.skuHooks]=[],i.find("ul").html(c.process(e)),this.cfg.isYuYue||this.imgScroll(i),i.data("loaded",!0))},bindEvent:function(t){var i=this;return this.$el.undelegate().delegate("input","change",function(){var t=$(this).attr("data-sku");i.check(t,$(this))}),this.$el.delegate(".J-btn","click",function(){i.setLog()}),n.addListener("onStockReady",function(){t.havestock&&i.data.length?i.$el.show():i.$el.hide()}),this},check:function(t,i){var e="//cart.jd.com/reBuyForOrderCenter.action?",a=Number(this.$el.find(".master input").eq(0).data("jp")),s=[this.cfg.skuid];this.$el.find(".suits input:checked").each(function(){var t=Number($(this).data("jp")),i=Number($(this).data("sku"));i&&s.push(i),t&&(a+=t)}),this.$cmbPrice.html("\uffe5"+a.toFixed(2)),this.$count.html(s.length-1),this.$btn.attr("href",e+$.param({wids:s.join(","),nums:1})),pageConfig.accSelectedSkus=s},setLog:function(){var t=this.$tab.items.eq(this.$tab.index),i=[];t&&t.find("input").each(function(){var t=$(this).attr("checked");t&&i.push($(this).attr("data-sku"))}),i.length&&log("gz_item","gz_detail","02","tjpj_ycgm_ljgm",this.cfg.skuid+"-"+i.join("-"),"main")},set:function(t){var i=this;if(!t||!t.list||!this.$el.length)return!1;pageConfig[this.skuHooks]=[this.sku],t.skuHooks=this.skuHooks,this.data=[];for(var e={skuHooks:this.skuHooks,data:[]},a=0;a<t.list.length;a++){var s=t.list[a],n=s.accessoryShows;if(n.length&&n[0].wid&&6>a){n[0].typeName=s.typeName,n[0].typeId=s.typeId,e.data.push(n[0]),this.data.push({skuHooks:this.skuHooks,data:n,typeId:s.typeId,typeName:s.typeName});var o='<li data-tab="trigger" data-name="{0}" data-id="{1}" onclick=\'log("gz_item", "gz_detail","02","tjpj_pjfl_{0}","","main")\'>{0}</li>',d='                        <div class="switchable-wrap" data-tab="item">                            <div class="btns">                                <a href="javascript:void(0)" target="_self" class="prev-btn"></a>                                <a href="javascript:void(0)" target="_self" class="next-btn"></a>                            </div>                            <div class="lh-wrap">                                <ul class="lh clearfix"></ul>                            </div>                        </div>';this.$el.find(".suits").append(d),this.$el.find(".tab-main ul").append(o.format(s.typeName,s.typeId))}}if(e.data.length){this.$el.ETab({defaultIndex:0,onSwitch:function(t){i.switchTo(t),i.getPrice(t)}}),this.$tab=this.$el.data("ETab");var h=this.$tab.items.eq(0);h.find("ul").html(c.process(e)),this.cfg.havestock&&this.$el.show(),i.cfg.isYuYue||i.imgScroll(h),t.transform?this.$more.hide():this.$more.show()}},getPrice:function(t){var i=this;o.priceNum({skus:pageConfig[this.skuHooks],$el:this.$tab.items.eq(t),callback:function(t,e){var a=i.$el.find('input[data-sku="'+t+'"]');a.attr("data-jp",e.p),a.attr("data-mp",e.m)},onReady:function(t){i.check()}})},imgScroll:function(t){t.find(".lh-wrap").imgScroll({width:t.find(".lh li").eq(0).outerWidth(!0),visible:d.wideVersion?5:4,showControl:!0,step:d.wideVersion?5:4,loop:!1,prev:t.find(".prev-btn"),next:t.find(".next-btn")})}};module.exports.__id="fittings",module.exports.init=s});