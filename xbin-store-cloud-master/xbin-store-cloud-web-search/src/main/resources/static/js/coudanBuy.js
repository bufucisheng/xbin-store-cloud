/* product-search/1.0.2 coudanBuy.js Date:2016-12-06 18:22:05 */
define("js/coudanBuy.js",["js/pageInfo.js","js/trimPath.js"],function(require,a){var c=require("js/pageInfo.js");require("js/trimPath.js");var e='<div class="w"><div id="floatbar-cart" style="display:none" class="floatbar-cart flbar-cart-sales">	<div class="floatbar-ft">		<div class="floatbar-sales"></div>		<div class="floatbar-checkout">			<i class="bd-arrow"></i>			<div class="checkout-info">				<span class="price-total"><em class="label">\u603b\u4ef7</em><strong class="price"></strong></span>				<span class="sales-tip"></span>			</div>			<a href="//cart.jd.com/cart.action" class="btn-checkout">\u53bb\u8d2d\u7269\u8f66\u7ed3\u7b97</a>		</div>	</div></div></div>';var f;var g;var h=$(window);var i;var j,k,l;var m=1;function n(a){f=a.activityID,$(e).insertAfter("#J_searchWrap"),i=$("#floatbar-cart"),j=i.find(".floatbar-sales"),k=i.find(".price-total .price"),l=i.find(".sales-tip"),g=i.closest(".w"),c.isYiYao&&i.find(".btn-checkout").attr("href","//cart.yiyaojd.com/cart"),$.browser.isIE6()||(s(),h.bind("scroll resize",function(){s()})),q().then(o),$("#J_searchWrap").delegate(".addcart","click",function(a){a.preventDefault();var b=$(this);if(!b.hasClass("disabled")){var c=b.siblings(".focus").data("sku");var d=r(c);d.then(o),d.then(function(a){var c=a.promotion;var d=b.offset();var e;e=c&&"5"==c.ec?'<div class="m-quicktip"> <span  class="tip-inner tip-error"><i class="tip-icon"></i><em class="tip-title">\u6b64\u5546\u54c1\u65e0\u6cd5\u52a0\u5165\u8d2d\u7269\u8f66</em></span> </div>':c&&"0"==c.ec?'<div class="m-quicktip"><span class="tip-inner tip-success"><i class="tip-icon"></i><em class="tip-title">\u52a0\u5165\u8d2d\u7269\u8f66\u6210\u529f</em></span></div>':'<div class="m-quicktip"> <span  class="tip-inner tip-error"><i class="tip-icon"></i><em class="tip-title">\u52a0\u5165\u8d2d\u7269\u8f66\u5931\u8d25</em></span> </div>';var f=$(e).css({position:"absolute",top:d.top-50,left:d.left-27,"z-index":20});$("body").append(f),f.delay(1500).fadeOut()})}}),j.hover(function(){$(this).addClass("z-sales-active")},function(){$(this).removeClass("z-sales-active")})}a.init=n;function o(a){var b=a.promotion;var c="";var d="";if(11==b.suitType)m=11,c="\u6ee1\u51cf",d=b.achieveCondition?"\u6ee1\u8db3\u6761\u4ef6\uff0c\u5df2\u51cf"+b.preferentialMoney+"\u5143</span>":Number(b.balanceNums)>0?"\u8fd8\u5dee"+b.balanceNums+"\u4ef6\uff0c\u5373\u53ef\u4eab\u53d7\u6ee1\u51cf\u4f18\u60e0":"\u8fd8\u5dee"+b.balanceMoney+"\u5143\uff0c\u5373\u53ef\u4eab\u53d7\u6ee1\u51cf\u4f18\u60e0";else{if(13!=b.suitType)return;m=13,c="\u6ee1\u8d60",d=b.achieveCondition?Number(b.addMoney)>0?"\u5df2\u6ee1\u8db3\u6761\u4ef6\uff0c\u8bf7\u53bb\u8d2d\u7269\u8f66\u6362\u8d2d\u5546\u54c1":"\u5df2\u6ee1\u8db3\u6761\u4ef6\uff0c\u8bf7\u53bb\u8d2d\u7269\u8f66\u9886\u53d6\u8d60\u54c1":Number(b.balanceNums)>0?"\u8fd8\u5dee"+b.balanceNums+"\u4ef6\uff0c\u5373\u53ef\u9886\u8d60\u54c1":Number(b.addMoney)>0?"\u8fd8\u5dee"+b.balanceMoney+"\u5143\uff0c\u5373\u53ef\u6362\u8d2d\u5546\u54c1":"\u8fd8\u5dee"+b.balanceMoney+"\u5143\uff0c\u5373\u53ef\u9886\u8d60\u54c1"}p(b)&&i.show(),j.html(c+'<span class="sep">|</span>'+b.promotion.promoNote),k.html("\xa5"+(parseFloat(b.totalPrice)-parseFloat(b.preferentialMoney)).toFixed(2).replace(/\.00$/,"")),l.html(d)}function p(a){var b=!1;return a.list&&a.list.length>0&&$.each(a.list,function(a,c){1==c.mainSku.checkType&&(b=!0)}),b}function q(){var a="//coudan.jd.com/coudan/getMiniCart.jsonp";return c.isYiYao&&(a="//cart.yiyaojd.com/getMiniCart.action"),$.ajax({url:a,data:{targetId:f},cache:!1,dataType:"jsonp"})}function r(a){var b="//coudan.jd.com/coudan/addItem.jsonp";return c.isYiYao&&(b="//cart.yiyaojd.com/addItem.action"),$.ajax({url:b,data:{targetId:f,ptype:m,pid:a},dataType:"jsonp",cache:!1})}function s(){h.scrollTop()+h.height()<g.offset().top?i.addClass("z-flbar-fixed"):i.removeClass("z-flbar-fixed")}});
