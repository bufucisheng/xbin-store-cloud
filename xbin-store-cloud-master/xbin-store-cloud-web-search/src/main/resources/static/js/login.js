/* jdf-1.0.0/ login.js Date:2017-02-09 17:08:53 */
define("/js/login.js",["/js/setUserInfo.js","/js/event.js","/js/dialog.js"],function(require){var c=require("/js/setUserInfo.js");var d=require("/js/event.js");require("/js/dialog.js");var f={};window.jdModelCallCenter=f;var g="https:"==document.location.protocol?"https://":"http://";d.on("loginSuccessByIframe",function(){c({callback:function(){$.closeDialog(),$.ajax({url:g+"passport.jd.com/loginservice.aspx?callback=?",data:{method:"Login"},dataType:"json",success:function(a){null!=a&&a.Identity.IsAuthenticated&&d.trigger("loginSuccessCallback",a)}})}})});var h={loginService:g+"passport.jd.com/loginservice.aspx?callback=?",loginMethod:"Login",loginUrl:g+"passport.jd.com/new/login.aspx",returnUrl:location.href,automatic:!1,complete:null,modal:!1,clstag1:0,clstag2:0,firstCheck:!0};var i=function(a){a=$.extend({},h,a||{});var b={login:function(){var b=navigator.userAgent.toLowerCase(),c="ucweb"==b.match(/ucweb/i)||"rv:1.2.3.4"==b.match(/rv:1.2.3.4/i);return c?void(location.href=a.loginUrl+"?ReturnUrl="+escape(returnUrl)):($.closeDialog(),void(this.loginDialog=$("body").dialog({title:"\u60a8\u5c1a\u672a\u767b\u5f55",width:410,height:420,autoIframe:!1,type:"iframe",fixed:!0,mainId:"loginDialogBody",source:"https://passport.jd.com/uc/popupLogin2013?clstag1="+a.clstag1+"&clstag2="+a.clstag2+"&r="+Math.random(),autoUpdate:!0})))},regist:function(){$.closeDialog(),this.registDialog=$("body").dialog({title:"\u60a8\u5c1a\u672a\u767b\u5f55",width:410,height:470,type:"iframe",fixed:!0,mainId:"registDialogBody",source:"https://reg.jd.com/reg/popupPerson?clstag1="+a.clstag1+"&clstag2="+a.clstag2+"&r="+Math.random(),autoUpdate:!0})}};if(f.regist=function(){b.regist()},f.login=function(){b.login()},f.init=function(a){d.trigger("loginSuccessByIframe",a)},""!=a.loginService&&""!=a.loginMethod){var c=function(c){if(null!=c&&(a.automatic&&null!=a.complete&&a.complete(c),c.Identity.IsAuthenticated&&null!=a.complete&&!a.automatic&&a.complete(c),!c.Identity.IsAuthenticated&&""!=a.loginUrl&&!a.automatic))if(a.modal){function e(b){null!=a.complete&&a.complete(b)}a.firstCheck&&(b.login(),d.off("loginSuccessCallback"),d.on("loginSuccessCallback",e))}else location.href=a.loginUrl+"?ReturnUrl="+escape(a.returnUrl)};a.firstCheck?j(a,c):(b.login(),d.on("loginSuccessCallback",function(b){null!=a.complete&&a.complete(b)}))}};function j(a,b){$.ajax({url:a.loginService,data:{method:a.loginMethod},dataType:"jsonp",scriptCharset:"gbk",success:function(a){b(a)}})}return i.isLogin=function(a,b){$.isFunction(a)?(b=a,a=h):a=$.extend({},h,a||{}),$.isFunction(b)||(b=function(){});var c=function(a){a&&a.Identity?b(a.Identity.IsAuthenticated,a):b(!1,null)};j(a,c)},i});
