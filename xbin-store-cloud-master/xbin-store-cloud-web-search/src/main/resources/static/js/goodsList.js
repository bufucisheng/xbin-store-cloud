/* product-search/1.0.2 goodsList.js Date:2016-12-06 18:22:05 */
define("js/goodsList.js",["js/switchable.js","js/follow.js","js/tools.js"],function(require,a,b){require("js/switchable.js");var d=require("js/follow.js");var e=require("js/tools.js");var f={};f.init=function(){this.wrap=$("#J_main").find(".J-goods-list"),this.setItemHover(),this.setTabHover(),this.setImgTab(),this.setImgSlider(),this.setSkuFocus(),this.setSkuNotification()},f.setTabHover=function(){this.wrap.find(".gl-i-tab-trigger .item").bind("mouseenter",function(){var b=$(this).index();var c=$(this).parents(".gl-i-tab-trigger").siblings(".gl-i-tab-content").find(".tab-content-item").eq(b);$(this).addClass("selected").siblings().removeClass("selected"),c.addClass("tab-cnt-i-selected").siblings().removeClass("tab-cnt-i-selected"),c.lazyload()})},f.setItemHover=function(){var a=this;this.wrap.find(".gl-item").bind("mouseenter",function(){a.wrap.hasClass("gl-type-5")||$(this).addClass("hover")}).bind("mouseleave",function(){$(this).removeClass("hover")})},f.setImgTab=function(){var a=this.wrap.find(".p-scroll");if(a.length>0){var b=$("#J_goodsList").hasClass("gl-type-2")?"/n8/":"/n7/";a.find("li").bind("mouseenter",function(){var c=$(this).parents(".gl-item");var d=$(this);var f=d.find("img");var g=c.find(".p-img");var h=c.find(".p-name");var i=c.find(".p-focus");var j=c.find(".p-commit");var k=d.closest(".ps-main");var l=f.attr("src").replace("/n9/",b);var m=f.attr("data-sku");var n=g.find("a").attr("href").replace(/\/\d{6,}/,"/"+m);f.data("url")&&(n=f.data("url")),g.find("a").attr("href",n),g.find("img").attr("src",l),h.find("a").attr("href",n),i.find("a").attr("data-sku",m),f.data("url")?j.find("a").attr("href",n):j.find("a").attr("href",j.find("a").attr("href").replace(/\/\d{6,}/,"/"+m)),d.find("a").addClass("curr").end().siblings().find("a").removeClass("curr");var o=k.data("priceData");if(o)o[f.data("sku")]&&c.find(".p-price i").text(o[f.data("sku")]);else{var p=k.find(".ps-item a img").map(function(){return $(this).data("sku")}).get();e.getPrice(p,!0,function(a){var b={};a.forEach(function(a){b[a.sku]=a.pText}),k.data("priceData",b),c.find(".p-price i").text(b[k.find(".curr img").data("sku")])}),k.data("priceData",{})}})}},f.setImgSlider=function(){var a=this.wrap.find(".p-scroll");a.length>0&&a.each(function(){$(this).find(".ps-item").length>6&&($(this).addClass("scrolled"),$(this).switchable({bodyClass:"ps-wrap",contentClass:"ps-main",mainClass:"ps-item",mainSelectedClass:"curr",prevClass:"ps-prev",nextClass:"ps-next",pagCancelClass:"disabled",type:"imgscroll",step:1,autoLock:!0,hasPage:!0,visible:5,speed:200,event:"mouseover",width:34,callback:function(a){0===a||this.content.data("slaveImageLoaded")||(this.content.lazyload({type:"img",source:"data-lazy-img-slave",placeholderClass:"err-product"}),this.content.data("slaveImageLoaded",!0))}}))})},f.setSkuFocus=function(){return"undefined"!=typeof window.searchUnit.followInited?!1:($("body").delegate(".J_focus","click",function(a){var b=$(this);var c=b.attr("data-sku");d.add(c,function(){b.hasClass("focus")?b.html("<i></i>\u5df2\u5173\u6ce8").addClass("focused"):b.html("<i></i>\u5df2\u5173\u6ce8").parent().addClass("p-focused")},{isShowInfo:!1}),a.preventDefault()}),void(window.searchUnit.followInited=!0))},f.setSkuNotification=function(){return searchUnit.notifyInited?!1:void seajs.use("jdf/1.0.0/unit/notif/1.0.0/notif.js",function(a){a({el:$(".J_notification")}),searchUnit.notifyInited=!0})},b.exports=f});
