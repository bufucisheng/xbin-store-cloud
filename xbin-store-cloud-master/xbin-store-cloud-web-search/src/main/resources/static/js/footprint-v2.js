/*
 JDModules Compressed by uglify 
 Author:keelii 
 Date: 2016-08-18 
 */
define("js/footprint-v2",function(require,a,b){function c(){var a=20,b="book"==document.body.id||1==pageConfig.searchType,c=pageConfig.product&&pageConfig.product.skuid?pageConfig.product.skuid:"",e='            <div class="mt">                <h2 class="title">\u6211\u7684\u8db3\u8ff9</h2>                <div class="extra"><a clstag="personal|keycount|myhistory|gdll407" href="//my.jd.com/history/list.html" target="_blank">\u66f4\u591a\u6d4f\u89c8\u8bb0\u5f55</a></div>            </div>            <div class="mc">                <ul class="recent-view-list clearfix">                    {for item in data}                    <li ${pageConfig.getFootPrintClk(item, item_index).recent} data-push="${pageConfig.footmarkSkus.push(item.sku)}" data-clk="${item.clk}">                        <div class="p-img">                            <a href="//item.jd.com/${item.sku}.html" title="${item.t}" target="_blank">                                <img src="${pageConfig.FN_GetImageDomain(item.sku)}n1/s70x70_${item.img}" alt="${item.t}" width="70px" height="70px" />                            </a>                        </div>                        <div class="p-price J-p-${item.sku}">&yen;</div>                    </li>                    {/for}                </ul>            </div>',f='            <div class="mt clearfix">                <h2 class="title">\u731c\u4f60\u559c\u6b22</h2>                <div class="extra"><a clstag="personal|keycount|myhistory|hyp407" href="#none" class="change"><i class="ico"></i><span class="txt">\u6362\u4e00\u6279</span></a></div>            </div>            <div class="mc">                <ul class="may-like-list clearfix">                    {for item in data}                    <li ${pageConfig.getFootPrintClk(item, item_index).guess} data-push="${pageConfig.footmarkSkus.push(item.sku)}" data-clk="${item.clk}">                        <div class="p-img">                            <a href="//item.jd.com/${item.sku}.html" title="${item.t}" target="_blank">                                <img src="${pageConfig.FN_GetImageDomain(item.sku)}n3/${item.img}" alt="${item.t}" width="130" height="130" />                            </a>                        </div>                        <div class="p-name"><a href="//item.jd.com/${item.sku}.html" target="_blank" title="${item.t}">${item.t}</a></div>                        <div class="p-review"><a class="p-comm-${item.sku}" href="//club.jd.com/review/${item.sku}-1-1.html" target="_blank">(\u5df2\u6709\u4eba\u8bc4\u4ef7)</a></div>                        <div class="p-price J-p-${item.sku}">&yen;</div>                    </li>                    {/for}                </ul>            </div>';!function(){var a=$("#footprint").parent(),b='                <div class="m hide may-like">                    <div class="loading-style1"><b></b>\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...</div>                </div>                <div class="m hide recent-view">                    <div class="loading-style1"><b></b>\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...</div>                </div>';a.after('<div id="footmark" class="w footmark"></div>'),$(".footmark").html(b),a.remove()}(),b?(new d({$el:$(".recent-view"),template:e,param:{p:202001,sku:c,ck:"pinId,lighting,pin,bview",lim:a},onLoad:function(a,b){log("BOOK&HomeHis","Show")}}),new d({$el:$(".may-like"),template:f,param:{p:202e3,sku:c,ck:"pinId,lighting,pin,ipLocation,btw,bview",lim:a},onLoad:function(a,b){log("BOOK&HomeTrack","Show")},type:"mixer"})):(new d({$el:$(".may-like"),template:f,param:{p:202002,sku:c,ck:"pinId,lighting,pin,ipLocation,atw,aview",lim:a},onLoad:function(a,b){clsPVAndShowLog("","",2,"s")},type:"mixer"}),new d({$el:$(".recent-view"),template:e,param:{p:202001,sku:c,ck:"pinId,lighting,pin,aview",lim:a},onLoad:function(a,b){clsPVAndShowLog("","",3,"s")}}))}require("js/trimPath.js"),require("js/lazyload.js"),require("js/clslog"),$("#footprint");pageConfig.getFootPrintClk=function(a,b){var c="book"==document.body.id||1==pageConfig.searchType,d={item:a,ind:b};return c?{recent:" onclick=\"clsLog('${item.sku}&HomeHis', '', '${item.sku}#${item.jp}', ${ind}, 'reWidsBookHis');\"".process(d),guess:" onclick=\"clsLog('${item.sku}&HomeTrack', '', '${item.sku}#${item.jp}', ${ind}, 'reWidsBookTrack');\"".process(d)}:{recent:" onclick=\"clsClickLog('', '', '${item.sku}', 3, ${ind}, 'rodGlobalHis');\"".process(d),guess:" onclick=\"clsClickLog('', '', '${item.sku}', 2, ${ind}, 'rodGlobalTrack');\"".process(d)}};var d=function(a){if(this.param=$.extend({lid:"1",lim:10,ec:"utf-8",uuid:-1,pin:readCookie("pin")||""},a.param),this.$el=a.$el,this.template=a.template,this.onLoad=a.onLoad||function(){},this.debug=a.debug,this.type=a.type,!this.param.p)throw new Error("The param [p] is not Specificed");this.init()};d.prototype={init:function(){var a=readCookie("__jda");this.param.lid.indexOf("-")>0?this.param.lid=this.param.lid.split("-")[0]:this.param.lid=this.param.lid,a?"-"==a.split(".")[1]?this.param.uuid=-1:this.param.uuid=a.split(".")[1]:this.param.uuid=-1,this.get(this.rid)},get:function(a,b){var c,d,e=this,f=pageConfig.queryParam,g=[],h="//diviner.jd.com/diviner?";if("mixer"==this.type&&(h="//mixer.jd.com/mixer?"),pageConfig.product)for(c=0;c<pageConfig.product.cat.length;c++)this.param["c"+(c+1)]=pageConfig.product.cat[c];if(f){for(var d in f)f.hasOwnProperty(d)&&("c1"==d||"c2"==d||"c3"==d?e.param[d]=f[d]||"":g.push(d+":"+f[d]));e.param.hi=g.join(",")}this.debug,$.ajax({url:h+decodeURIComponent($.param(this.param)),dataType:"jsonp",scriptCharset:this.param.ec,success:function(a){this.debug,e.set(a)}})},set:function(a){this.$el,this.tpl||"";pageConfig.footmarkSkus=[],a.success&&a.data&&a.data.length>0&&(this.$el.html(this.template.process(a)).show(),this.getPriceNum(pageConfig.footmarkSkus,this.param.lid,this.$el),this.getCommentData(pageConfig.footmarkSkus,this.$el),this.setTrackCode(a.impr),this.bindChange(),this.onLoad(this,a))},bindChange:function(){function a(a,b,c){var d=0,e=a.length,f=1;a.each(function(a){a%c===0&&d++,$(this).attr("data-gid",d)}),b.unbind("click").bind("click",function(){f>=e/c&&(f=0);var b=a.filter('[data-gid="'+ ++f+'"]');a.hide(),b.show(),b.lazyload({type:"img"})})}var b=this.$el.find(".mc").outerWidth(),c=this.$el.find("li").outerWidth(),d=parseInt(b/c,10);a(this.$el.find(".mc ul li"),this.$el.find(".mt .change"),d)},getCommentData:function(a,b,c){a=a||[],b=b||$("body").eq(0),c=c||"p-comm-",$.ajax({url:"//club.jd.com/comment/productCommentSummaries.action?my=pinglun&referenceIds="+a,dataType:"jsonp",success:function(a){var b;if(a&&a.CommentsCount.length){b=a.CommentsCount.length;for(var d=0;b>d;d++)$("."+c+a.CommentsCount[d].SkuId).html("(\u5df2\u6709"+a.CommentsCount[d].CommentCountStr+"\u4eba\u8bc4\u4ef7)")}}})},setTrackCode:function(a){var b=this.$el.find("li"),c=this,d="&m=UA-J2011-1&ref="+encodeURIComponent(document.referrer);b.each(function(){var a=$(this).attr("data-clk");$(this).bind("click",function(b){var e=$(b.target);(e.is("a")||e.is("img")||e.is("span"))&&c.newImage(a+d,!0),e.is("input")&&1==e.attr("checked")&&c.newImage(a+d,!0)})}),this.newImage(a+d,!0)},newImage:function(a,b,c){var d=new Image;a=b?a+"&random="+Math.random()+(new Date).getTime():a,d.onload=function(){"undefined"!=typeof c&&c(a)},d.setAttribute("src",a)},getPriceNum:function(a,b,c,d,e){a="string"==typeof a?[a]:a,c=c||$("body"),d=d||"J-p-";var f="";if(null!==b&&(f=readCookie("ipLoc-djd")?"&area="+readCookie("ipLoc-djd").split(".")[0].replace(/-/g,"_"):"&area=1"),"undefined"!=typeof a){var g=readCookie("__jda"),h=g&&g.indexOf(".")>-1?g.split(".")[1]:"",i=readCookie("pin")||"",j=readCookie("pdtk")||"",k="//p.3.cn/prices/mgets?type=1&skuIds=J_"+a.join(",J_")+f+"&pduid="+h+"&pdpin="+i+"&pdbp=0&pdtk="+j;$.ajax({url:k,dataType:"jsonp",success:function(a){if(!a&&!a.length)return!1;for(var b=0;b<a.length;b++){if(!a[b].id)return!1;var f=a[b].id.replace("J_",""),g=parseFloat(a[b].p);parseFloat(a[b].m);g>0?c.find("."+d+f).html("\uffe5"+a[b].p):c.find("."+d+f).html("\u6682\u65e0\u62a5\u4ef7"),"function"==typeof e&&e(f,a[b],k)}}})}}},a.init=c});